
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>68-实战篇  t3-app 实战  身份认证与主题切换</title>
  <style>
    body {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
    }
    pre {
      background-color: #f6f8fa;
      padding: 16px;
      border-radius: 6px;
      overflow: auto;
    }
    code {
      font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
    }
  </style>
</head>
<body>
<h2>前言</h2>
<p>我们使用 <strong>Typescript + Tailwind + Prisma + MySQL + Zod + Shadcn UI + React Hook Form + Clerk + Server Actions</strong> 开发一个清单项目。</p>
<p>项目效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/150472b462c74d3aaf8065a460cf4357~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1106&h=1006&s=1465739&e=gif&f=310&b=fdfdfd" alt="t32.gif"></p>
<h2>1. 项目初始化</h2>
<p>运行：</p>
<pre><code class="language-bash">npm create t3-app@latest
</code></pre>
<blockquote>
<ol>
<li>Will you be using TypeScript or JavaScript?<ul>
<li>TypeScript</li>
</ul>
</li>
<li>Will you be using Tailwind CSS for styling?<ul>
<li>Yes</li>
</ul>
</li>
<li>Would you like to use tRPC?<ul>
<li>No</li>
</ul>
</li>
<li>What authentication provider would you like to use?<ul>
<li>None（因为接入 Clerk）</li>
</ul>
</li>
<li>What database ORM would you like to use?<ul>
<li>Prisma</li>
</ul>
</li>
<li>Would you like to use Next.js App Router?<ul>
<li>Yes</li>
</ul>
</li>
<li>What database provider would you like to use?<ul>
<li>MySQL（选择其他喜欢的数据库也行）</li>
</ul>
</li>
<li>Should we initialize a Git repository and stage the changes?<ul>
<li>Yes</li>
</ul>
</li>
<li>Should we run &#39;npm install&#39; for you?<ul>
<li>Yes</li>
</ul>
</li>
<li>What import alias would you like to use?<ul>
<li>@（按照个人习惯设置即可）</li>
</ul>
</li>
</ol>
</blockquote>
<p>本地开启 MySQL 数据库，修改 <code>.env</code>中的数据库地址：</p>
<pre><code class="language-bash"># 修改用户名、密码，用于连接本地数据库
# next-t3-todo 表示数据库名，数据库不需要先行创建
DATABASE_URL=&quot;mysql://username:password@localhost:3306/next-t3-todo&quot;
</code></pre>
<p>运行：</p>
<pre><code class="language-bash"># 进入项目目录
cd next-t3-todo
# 相当于 prisma db push
npm run db:push
</code></pre>
<p>效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e222fd2999db460996641aa44164ee5f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1666&h=594&s=118889&e=png&b=1f1f1f" alt="image.png"></p>
<p>此时会创建数据库，并将数据库和 Prisma schema 同步。</p>
<p>运行：</p>
<pre><code class="language-bash"># 开发模式
npm run dev
# 提交代码
git commit -m &quot;initial commit&quot;
</code></pre>
<p>我们的项目就正式开始了。</p>
<h2>2. 功能：身份认证</h2>
<p>我们先做身份认证，毕竟身份认证是基础，且创建清单的时候需要用户信息。</p>
<p>为了快速实现，最便捷的方式是接入 Clerk。我们将接入 Clerk 并实现界面的汉化。</p>
<h3>2.1. 接入 Clerk</h3>
<p>安装依赖项：</p>
<pre><code class="language-bash"># 安装依赖项，其中 lodash.merge 用于界面汉化
npm i --save @clerk/localizations @clerk/nextjs lodash.merge
# 安装开发依赖项
npm i --save-dev @types/lodash.merge
</code></pre>
<p>在 <a href="https://dashboard.clerk.com/">Clerk</a> 创建一个应用，创建后查看密钥信息。</p>
<p>项目根目录新建 <code>.env.local</code>文件，代码如下：</p>
<pre><code class="language-javascript">NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
CLERK_SECRET_KEY=sk_test_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre>
<p>新建 <code>src/middleware.ts</code>文件，代码如下：</p>
<pre><code class="language-javascript">import { clerkMiddleware } from &quot;@clerk/nextjs/server&quot;;

export default clerkMiddleware();

export const config = {
  matcher: [&#39;/((?!.*\\..*|_next).*)&#39;, &#39;/&#39;, &#39;/(api|trpc)(.*)&#39;],
};
</code></pre>
<blockquote>
<p>注意： middleware.ts 并不一定放在项目根目录，放在与 app 同级目录位置</p>
</blockquote>
<p>修改 <code>src/app/layout.tsx</code>，代码如下：</p>
<pre><code class="language-jsx">import &quot;@/styles/globals.css&quot;;

import { type Metadata } from &quot;next&quot;;
import {
  ClerkProvider,
  SignInButton,
  SignedIn,
  SignedOut,
  UserButton,
} from &quot;@clerk/nextjs&quot;;

export const metadata: Metadata = {
  title: &quot;Create T3 App&quot;,
  description: &quot;Generated by create-t3-app&quot;,
  icons: [{ rel: &quot;icon&quot;, url: &quot;/favicon.ico&quot; }],
};

export default function RootLayout({
  children,
}: Readonly&lt;{ children: React.ReactNode }&gt;) {
  return (
    &lt;ClerkProvider&gt;
      &lt;html lang=&quot;en&quot;&gt;
        &lt;body&gt;
          &lt;header&gt;
            &lt;SignedOut&gt;
              &lt;SignInButton /&gt;
            &lt;/SignedOut&gt;
            &lt;SignedIn&gt;
              &lt;UserButton /&gt;
            &lt;/SignedIn&gt;
          &lt;/header&gt;
          &lt;main&gt;{children}&lt;/main&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    &lt;/ClerkProvider&gt;
  );
}
</code></pre>
<p>重新运行 <code>npm run dev</code>，此时效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/885cb5da153a450e9d37bb5ad99f7122~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2000&h=676&s=128948&e=png&b=22135e" alt="image.png"></p>
<h3>2.2. 自定义登录和注册地址</h3>
<p>当我们点击 <code>Sign in</code> 的时候，跳转的其实是 Clerk 的地址，如果要修改为我们自己的路由地址该怎么做呢？</p>
<p>新建 <code>src/app/(auth)/sign-in/[[...sign-in]]/page.tsx</code>，代码为：</p>
<pre><code class="language-jsx">import { SignIn } from &quot;@clerk/nextjs&quot;;

export default function Page() {
  return &lt;SignIn /&gt;;
}
</code></pre>
<p>新建 <code>src/app/(auth)/sign-up/[[...sign-up]]/page.tsx</code>，代码为：</p>
<pre><code class="language-jsx">import { SignUp } from &quot;@clerk/nextjs&quot;;

export default function Page() {
  return &lt;SignUp /&gt;;
}
</code></pre>
<p>修改 <code>.env.local</code>文件，添加如下代码：</p>
<pre><code class="language-bash">NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
</code></pre>
<p>重新运行 <code>npm run dev</code>，浏览器效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/09a9b804f3fd44138635e701d5d11baf~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1106&h=376&s=235638&e=gif&f=61&b=260e5f" alt="t33.gif"></p>
<p>效果描述：当点击登录的时候，跳转的是 <code>http://localhost/sign-in</code></p>
<h3>2.3. 界面汉化</h3>
<p>修改 <code>src/app/layout.tsx</code>，完整代码如下：</p>
<pre><code class="language-jsx">import &quot;@/styles/globals.css&quot;;

import { type Metadata } from &quot;next&quot;;
import {
  ClerkProvider,
  SignInButton,
  SignedIn,
  SignedOut,
  UserButton,
} from &quot;@clerk/nextjs&quot;;
// Step1: 引入汉化文件
import { zhCN } from &quot;@clerk/localizations&quot;;

export const metadata: Metadata = {
  title: &quot;Create T3 App&quot;,
  description: &quot;Generated by create-t3-app&quot;,
  icons: [{ rel: &quot;icon&quot;, url: &quot;/favicon.ico&quot; }],
};

export default function RootLayout({
  children,
}: Readonly&lt;{ children: React.ReactNode }&gt;) {
  // Step2: 设置 ClerkProvider 的 localization
  return (
    &lt;ClerkProvider localization={zhCN}&gt;
      {/** Step3: 别忘了 html lang */}
      &lt;html lang=&quot;zh-CN&quot;&gt;
        &lt;body&gt;
          &lt;header&gt;
            &lt;SignedOut&gt;
              {/** Step4: 如果按钮文案要改为中文 */}
              &lt;SignInButton&gt;登录&lt;/SignInButton&gt;
            &lt;/SignedOut&gt;
            &lt;SignedIn&gt;
              &lt;UserButton /&gt;
            &lt;/SignedIn&gt;
          &lt;/header&gt;
          &lt;main&gt;{children}&lt;/main&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    &lt;/ClerkProvider&gt;
  );
}
</code></pre>
<p>此时界面基本完成汉化，浏览器效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/308f631abcba4e0ba01a90ae0c5bb7d8~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1108&h=548&s=388125&e=gif&f=69&b=260e5f" alt="t34.gif"></p>
<p>但查看用户界面，你就会发现，这个汉化并不全面！就比如删除按钮这里的文案依然是英文……</p>
<p>新建 <code>src/locales/zh.json</code>，代码如下：</p>
<pre><code class="language-javascript">{
  &quot;userProfile&quot;: {
    &quot;start&quot;: {
      &quot;dangerSection&quot;: {
        &quot;deleteAccountButton&quot;: &quot;删除账户&quot;,
        &quot;title&quot;: &quot;账户终止&quot;
      }
    }
  }
}
</code></pre>
<p>修改 <code>src/app/layout.tsx</code>，代码如下：</p>
<pre><code class="language-jsx">import &quot;@/styles/globals.css&quot;;

import { type Metadata } from &quot;next&quot;;
import {
  ClerkProvider,
  SignInButton,
  SignedIn,
  SignedOut,
  UserButton,
} from &quot;@clerk/nextjs&quot;;
import { zhCN } from &quot;@clerk/localizations&quot;;
// Step1: 引入翻译文件
import zhCNlocales from &quot;@/locales/zh.json&quot;;
import merge from &quot;lodash.merge&quot;;

export const metadata: Metadata = {
  title: &quot;Create T3 App&quot;,
  description: &quot;Generated by create-t3-app&quot;,
  icons: [{ rel: &quot;icon&quot;, url: &quot;/favicon.ico&quot; }],
};

export default function RootLayout({
  children,
}: Readonly&lt;{ children: React.ReactNode }&gt;) {
  // Step2: 合并翻译文件
  const localization = merge(zhCN, zhCNlocales);
  // Step3: 设置 ClerkProvider 的 localization
  return (
    &lt;ClerkProvider localization={localization}&gt;
      &lt;html lang=&quot;zh-CN&quot;&gt;
        &lt;body&gt;
          &lt;header&gt;
            &lt;SignedOut&gt;
              &lt;SignInButton&gt;登录&lt;/SignInButton&gt;
            &lt;/SignedOut&gt;
            &lt;SignedIn&gt;
              &lt;UserButton /&gt;
            &lt;/SignedIn&gt;
          &lt;/header&gt;
          &lt;main&gt;{children}&lt;/main&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    &lt;/ClerkProvider&gt;
  );
}
</code></pre>
<p>此时删除账户界面就改为了中文：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ab6276bd354840658a37720c8cc57afa~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2210&h=370&s=31090&e=png&b=ffffff" alt="image.png"></p>
<p>那么问题来了：如果还有其他需要汉化的位置，怎么知道具体的字段位置呢？就比如为什么“删除账户”，它对应的字段位置是 userProfile.start.dangerSection.deleteAccountButton 呢？</p>
<p>其实这是个体力活：打开原本的<a href="https://github.com/clerk/javascript/blob/main/packages/localizations/src/en-US.ts">英文</a>，搜索对应文案，就可以找到具体的字段位置了。</p>
<blockquote>
<p>注意：目前中文翻译并不全面，这是一个给 Clerk 提 PR 的好机会！</p>
</blockquote>
<h3>2.4. 设置路由保护</h3>
<p>毕竟我们开发的是一个清单项目，当用户打开首页的时候，应该是登录后才能查看到自己创建的清单。所以我们实现一个路由保护，当用户访问 <code>/</code>的时候，会跳转到 <code>/sign-in</code>，引导用户登录。</p>
<p>修改  <code>src/middleware.ts</code>，完整代码如下：</p>
<pre><code class="language-javascript">import { clerkMiddleware, createRouteMatcher } from &quot;@clerk/nextjs/server&quot;;

const isPublicRoute = createRouteMatcher([&quot;/sign-in(.*)&quot;, &quot;/sign-up(.*)&quot;]);

export default clerkMiddleware((auth, request) =&gt; {
  if (!isPublicRoute(request)) {
    auth().protect();
  }
});

export const config = {
  matcher: [&quot;/((?!.*\\..*|_next).*)&quot;, &quot;/&quot;, &quot;/(api|trpc)(.*)&quot;],
};
</code></pre>
<p>在这段代码中，我们设置了 <code>/sign-in</code> 和 <code>/sign-up</code> 为公共路由，访问其他路由，都会触发路由保护，跳转到登录页面。</p>
<blockquote>
<p>注意：这里中间件的 matcher 逻辑是，除了内部路由 <code>_next</code> 和静态文件之外，其他都会受到保护</p>
</blockquote>
<p>修改  <code>src/app/layout.tsx</code>，代码如下：</p>
<pre><code class="language-jsx">import &quot;@/styles/globals.css&quot;;

import { type Metadata } from &quot;next&quot;;
import {
  ClerkProvider,
  SignInButton,
  SignedIn,
  SignedOut,
  UserButton,
} from &quot;@clerk/nextjs&quot;;
import { zhCN } from &quot;@clerk/localizations&quot;;
import zhCNlocales from &quot;@/locales/zh.json&quot;;
import merge from &quot;lodash.merge&quot;;

export const metadata: Metadata = {
  title: &quot;Create T3 App&quot;,
  description: &quot;Generated by create-t3-app&quot;,
  icons: [{ rel: &quot;icon&quot;, url: &quot;/favicon.ico&quot; }],
};

export default function RootLayout({
  children,
}: Readonly&lt;{ children: React.ReactNode }&gt;) {
  const localization = merge(zhCN, zhCNlocales);
  return (
    &lt;ClerkProvider localization={localization}&gt;
      &lt;html lang=&quot;zh-CN&quot;&gt;
        &lt;body&gt;
          {/* 注释或删除下面这段代码，在使用路由保护的时候会导致错误 */}
          {/* &lt;header&gt;
            &lt;SignedOut&gt;
              &lt;SignInButton&gt;登录&lt;/SignInButton&gt;
            &lt;/SignedOut&gt;
            &lt;SignedIn&gt;
              &lt;UserButton /&gt;
            &lt;/SignedIn&gt;
          &lt;/header&gt; */}
          &lt;main&gt;{children}&lt;/main&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    &lt;/ClerkProvider&gt;
  );
}
</code></pre>
<p>这是因为使用 <code>&lt;SignedIn&gt;</code> 和 <code>&lt;SignedOut&gt;</code> 组件会导致报错：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0dc8110f5cc4d9ca4204dd87b1bd99d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1696&h=390&s=104499&e=png&b=1e1e1e" alt="image.png"></p>
<p>现在我们就完成了 Clerk 的基础设置。浏览器效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f259171100b41d380999d811ade0e1e~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=965&h=554&s=89133&e=gif&f=46&b=fefefe" alt="t35.gif"></p>
<p>效果描述：访问首页，会跳转到登录页面，登录完成后，跳转会首页。</p>
<h2>3. 功能：支持深色模式</h2>
<p>接下来我们支持深色模式，我们借助 Shadcn UI 实现。</p>
<h3>3.1. 接入 Shadcn UI</h3>
<p>初始化 Shadcn UI：</p>
<pre><code class="language-bash">npx shadcn-ui@latest init
</code></pre>
<p>命令行效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e702766386c046afbc830f3f79a00eb0~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1554&h=438&s=109447&e=png&b=1e1e1e" alt="image.png"></p>
<p>添加组件：</p>
<pre><code class="language-bash">npx shadcn-ui@latest add
</code></pre>
<p>因为用到的组件很多，干脆全装了。敲击键盘的<code>a</code>，作用是全选组件（再敲击一次就是取消全选），然后进行安装。</p>
<h3>3.2. 实现主题切换器</h3>
<p>修改 <code>src/app/page.tsx</code>，代码如下：</p>
<pre><code class="language-jsx">export default function HomePage() {
  return (
    &lt;main className=&quot;flex w-full flex-col items-center&quot;&gt;
      &lt;div&gt;Hello World!&lt;/div&gt;
    &lt;/main&gt;
  );
}
</code></pre>
<p>修改 <code>src/app/layout.tsx</code>，完整代码如下：</p>
<pre><code class="language-jsx">import &quot;@/styles/globals.css&quot;;

import { type Metadata } from &quot;next&quot;;
import { ClerkProvider } from &quot;@clerk/nextjs&quot;;
import { zhCN } from &quot;@clerk/localizations&quot;;
import zhCNlocales from &quot;@/locales/zh.json&quot;;
import merge from &quot;lodash.merge&quot;;
// Step1: 添加组件
import ThemeProvider from &quot;@/components/ThemeProvider&quot;;
import Header from &quot;@/components/Header&quot;;

export const metadata: Metadata = {
  title: &quot;Create T3 App&quot;,
  description: &quot;Generated by create-t3-app&quot;,
  icons: [{ rel: &quot;icon&quot;, url: &quot;/favicon.ico&quot; }],
};

export default function RootLayout({
  children,
}: Readonly&lt;{ children: React.ReactNode }&gt;) {
  const localization = merge(zhCN, zhCNlocales);
  return (
    &lt;ClerkProvider localization={localization}&gt;
      {/* Step2: 设置 suppressHydrationWarning */}
      &lt;html lang=&quot;zh-CN&quot; suppressHydrationWarning&gt;
        &lt;body&gt;
          {/* Step3: 设置 ThemeProvider */}
          &lt;ThemeProvider
            attribute=&quot;class&quot;
            defaultTheme=&quot;system&quot;
            enableSystem
            disableTransitionOnChange
          &gt;
            &lt;Header /&gt;
            &lt;div className=&quot;flex w-full flex-col items-center&quot;&gt;{children}&lt;/div&gt;
          &lt;/ThemeProvider&gt;
        &lt;/body&gt;
      &lt;/html&gt;
    &lt;/ClerkProvider&gt;
  );
}
</code></pre>
<p>新建 <code>src/components/ThemeProvider.tsx</code>，代码如下：</p>
<pre><code class="language-jsx">&quot;use client&quot;;

import * as React from &quot;react&quot;;
import { ThemeProvider as NextThemesProvider } from &quot;next-themes&quot;;
import { type ThemeProviderProps } from &quot;next-themes/dist/types&quot;;

export default function ThemeProvider({
  children,
  ...props
}: ThemeProviderProps) {
  return &lt;NextThemesProvider {...props}&gt;{children}&lt;/NextThemesProvider&gt;;
}
</code></pre>
<p>新建 <code>src/components/Header.tsx</code>，代码如下：</p>
<pre><code class="language-jsx">import { UserButton } from &quot;@clerk/nextjs&quot;;
import ThemeToggle from &quot;./ThemeToggle&quot;;

export default function Header() {
  return (
    &lt;nav className=&quot;flex h-[60px] w-full items-center justify-between p-4&quot;&gt;
      &lt;h1&gt;嗒嗒清单&lt;/h1&gt;
      &lt;div className=&quot;flex items-center gap-2&quot;&gt;
        &lt;UserButton /&gt;
        &lt;ThemeToggle /&gt;
      &lt;/div&gt;
    &lt;/nav&gt;
  );
}
</code></pre>
<p>新建 <code>src/components/ThemeToggle.tsx</code>，代码如下：</p>
<pre><code class="language-jsx">&quot;use client&quot;;

import * as React from &quot;react&quot;;
import { Moon, Sun } from &quot;lucide-react&quot;;
import { useTheme } from &quot;next-themes&quot;;

import { Button } from &quot;@/components/ui/button&quot;;
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from &quot;@/components/ui/dropdown-menu&quot;;

export default function ModeToggle() {
  const { setTheme } = useTheme();

  return (
    &lt;DropdownMenu&gt;
      &lt;DropdownMenuTrigger asChild&gt;
        &lt;Button variant=&quot;outline&quot; size=&quot;icon&quot;&gt;
          &lt;Sun className=&quot;h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0&quot; /&gt;
          &lt;Moon className=&quot;absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100&quot; /&gt;
          &lt;span className=&quot;sr-only&quot;&gt;Toggle theme&lt;/span&gt;
        &lt;/Button&gt;
      &lt;/DropdownMenuTrigger&gt;
      &lt;DropdownMenuContent align=&quot;end&quot;&gt;
        &lt;DropdownMenuItem onClick={() =&gt; setTheme(&quot;light&quot;)}&gt;
          Light
        &lt;/DropdownMenuItem&gt;
        &lt;DropdownMenuItem onClick={() =&gt; setTheme(&quot;dark&quot;)}&gt;
          Dark
        &lt;/DropdownMenuItem&gt;
        &lt;DropdownMenuItem onClick={() =&gt; setTheme(&quot;system&quot;)}&gt;
          System
        &lt;/DropdownMenuItem&gt;
      &lt;/DropdownMenuContent&gt;
    &lt;/DropdownMenu&gt;
  );
}
</code></pre>
<p>此时浏览器效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4efb6a86a30740f8909ef3545000c670~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=959&h=408&s=67082&e=gif&f=33&b=fefefe" alt="t3-6.gif"></p>
<blockquote>
<p>注：更复杂的效果，比如修改主题色、增加主题请查看<a href="https://juejin.cn/book/7307859898316881957/section/7385045738771709979">《实战篇 | Shadcn UI 与组件库》</a></p>
</blockquote>
<h2>4. 功能：欢迎信息</h2>
<p>修改 <code>src/app/page.tsx</code>，完整代码如下：</p>
<pre><code class="language-jsx">import { Suspense } from &quot;react&quot;;
import {
  Card,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle,
} from &quot;@/components/ui/card&quot;;
import { Skeleton } from &quot;@/components/ui/skeleton&quot;;
import { currentUser } from &quot;@clerk/nextjs/server&quot;;
import CreateListModal from &quot;@/components/createListModal&quot;;

async function Welcome() {
  const user = await currentUser();

  if (!user) return null;

  return (
    &lt;Card className=&quot;w-full sm:col-span-2&quot; x-chunk=&quot;dashboard-05-chunk-0&quot;&gt;
      &lt;CardHeader className=&quot;pb-3&quot;&gt;
        &lt;CardTitle className=&quot;text-lg&quot;&gt;
          欢迎 {user.firstName} {user.lastName}!
        &lt;/CardTitle&gt;
        &lt;CardDescription className=&quot;max-w-lg text-balance leading-relaxed&quot;&gt;
          道虽迩，不行不至；事虽小，不为不成
        &lt;/CardDescription&gt;
      &lt;/CardHeader&gt;
      &lt;CardFooter&gt;
        &lt;CreateListModal /&gt;
      &lt;/CardFooter&gt;
    &lt;/Card&gt;
  );
}

function WelcomeFallback() {
  return &lt;Skeleton className=&quot;h-[180px] w-full&quot; /&gt;;
}

export default function HomePage() {
  return (
    &lt;main className=&quot;flex w-full flex-col items-center px-4&quot;&gt;
      &lt;Suspense fallback={&lt;WelcomeFallback /&gt;}&gt;
        &lt;Welcome /&gt;
      &lt;/Suspense&gt;
    &lt;/main&gt;
  );
}
</code></pre>
<p>在这段代码中，我们创建了一个 <code>&lt;Welcome&gt;</code>组件，当涉及到服务端请求时，应该尽可能将请求放到 <code>&lt;Suspense&gt;</code> 中，这样就不会阻塞页面的请求和渲染。</p>
<p>新建 <code>src/components/CreateListModal.tsx</code>，代码如下：</p>
<pre><code class="language-jsx">&quot;use client&quot;;

import { Button } from &quot;@/components/ui/button&quot;;
import { Input } from &quot;@/components/ui/input&quot;;
import { Label } from &quot;@/components/ui/label&quot;;
import {
  Sheet,
  SheetClose,
  SheetContent,
  SheetDescription,
  SheetFooter,
  SheetHeader,
  SheetTitle,
  SheetTrigger,
} from &quot;@/components/ui/sheet&quot;;

export default function Sidebar() {
  return (
    &lt;Sheet&gt;
      &lt;SheetTrigger asChild&gt;
        &lt;Button&gt;添加清单&lt;/Button&gt;
      &lt;/SheetTrigger&gt;
      &lt;SheetContent&gt;
        &lt;SheetHeader&gt;
          &lt;SheetTitle&gt;添加清单&lt;/SheetTitle&gt;
          &lt;SheetDescription&gt;
            清单是任务的集合，比如“工作”、“生活”、“副业”
          &lt;/SheetDescription&gt;
        &lt;/SheetHeader&gt;
        &lt;div className=&quot;grid gap-4 py-4&quot;&gt;
          &lt;div className=&quot;grid grid-cols-4 items-center gap-4&quot;&gt;
            &lt;Label htmlFor=&quot;name&quot; className=&quot;text-right&quot;&gt;
              清单名称：
            &lt;/Label&gt;
            &lt;Input
              id=&quot;name&quot;
              value=&quot;工作&quot;
              onChange={() =&gt; {
                console.log(1);
              }}
              className=&quot;col-span-3&quot;
              /&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;SheetFooter&gt;
          &lt;SheetClose asChild&gt;
            &lt;Button type=&quot;submit&quot;&gt;创建&lt;/Button&gt;
          &lt;/SheetClose&gt;
        &lt;/SheetFooter&gt;
      &lt;/SheetContent&gt;
    &lt;/Sheet&gt;
  );
}
</code></pre>
<p>此时浏览器效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/62bd6473108b4ceea002a9d68eb3fc48~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=959&h=408&s=108861&e=gif&f=24&b=fefefe" alt="t3-7.gif"></p>
<h2>下一篇</h2>
<blockquote>
<ol>
<li>功能实现：t3-app 身份认证和深色模式</li>
<li>源码地址：<a href="https://github.com/mqyqingfeng/next-app-demo/tree/next-t3-todo">https://github.com/mqyqingfeng/next-app-demo/tree/next-t3-todo</a></li>
<li>下载代码：<code>git clone -b next-t3-todo git@github.com:mqyqingfeng/next-app-demo.git</code></li>
</ol>
</blockquote>
<p>目前我们已经用 Clerk 实现了身份认证，使用 Shadcn UI + next-themes 实现了深色模式切换。当点击“添加清单”按钮的时候，右侧会弹出创建清单的表单，现在我们只是简单模拟了下大致效果。下一篇我们会用 Shadcn UI + React Hook Form + Zod + Server Actions 实现清单的创建和查询功能。</p>

</body>
</html>
  