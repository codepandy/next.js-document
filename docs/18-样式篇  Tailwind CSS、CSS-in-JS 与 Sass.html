
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>18-样式篇  Tailwind CSS、CSS-in-JS 与 Sass</title>
  <style>
    body {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
    }
    pre {
      background-color: #f6f8fa;
      padding: 16px;
      border-radius: 6px;
      overflow: auto;
    }
    code {
      font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
    }
  </style>
</head>
<body>
<h2>前言</h2>
<p>Next.js 支持多种方式添加样式：</p>
<ol>
<li>内联 CSS</li>
<li>CSS 模块：创建局部 CSS 避免命名冲突，提升可维护性</li>
<li>全局 CSS</li>
<li>外部样式表</li>
<li>Tailwind CSS：一个 CSS 框架，通过组合的方式声明样式</li>
<li>CSS-in-JS：将 CSS 直接嵌入到 JavaScript 组件中，实现动态和局部样式</li>
<li>Sass：最流行的 CSS 预处理器</li>
</ol>
<p>让我们来一一讲解。</p>
<h2>1. 内联 CSS</h2>
<p>最基础的添加样式的方式便是使用内联 CSS，举个例子：</p>
<pre><code class="language-javascript">// app/about/page.js
export default function About() {
  return (
    &lt;h1 style={{
      color: red;
    }}&gt;Hello About!&lt;/h1&gt;
  )
}
</code></pre>
<h2>2. CSS 模块</h2>
<p>Next.js 内置了对 CSS 模块的支持。使用 CSS 模块，你只需要使用 <code>.module.css</code>作为文件后缀名，Next.js 就会自动进行处理。</p>
<p>CSS 模块的作用在于实现局部 CSS，本质是创建一个不会重复的类名。这样你就可以在不同的文件里使用相同的类名，而不用担心发生样式冲突。这是最理想的实现组件级别 CSS 的方式。</p>
<p>让我们举个例子：</p>
<p>首先，创建一个 <code>styles.module.css</code>文件，样式书写方式如同正常的 CSS 文件：</p>
<pre><code class="language-javascript">// app/dashboard/styles.module.css
.dashboard {
  padding: 24px;
}
</code></pre>
<p>然后，CSS 模块可以被导入到 <code>app</code> 目录下的任意文件，让我们导入并使用该样式：</p>
<pre><code class="language-javascript">// app/dashboard/layout.js
import styles from &#39;./styles.module.css&#39;
 
export default function DashboardLayout({ children }) {
  return &lt;section className={styles.dashboard}&gt;{children}&lt;/section&gt;
}
</code></pre>
<h2>3. 全局样式</h2>
<p>全局样式，顾名思义，应用到所有路由的样式，像我们传统写页面 CSS 的时候，都会引入 <code>normalize.css</code> 或者 <code>reset.css</code>等，这种场景就适合使用全局样式。</p>
<p>全局样式可以被导入 <code>app</code> 目录下的任意 layout、page 或者组件中。（为什么总是强调任意呢？因为在 <code>pages</code> 目录下，也就是之前的 Pages Router 模式，全局样式只能被导入到 <code>_app.js</code> 文件，这是一个新的改变。）</p>
<p>具体怎么使用呢？让我们举个例子：</p>
<p>首先，创建一个 <code>app/global.css</code>  样式文件：</p>
<pre><code class="language-javascript">body {
  padding: 20px 20px 60px;
  max-width: 680px;
  margin: 0 auto;
}
</code></pre>
<p>然后，在根布局（<code>app/layout.js</code>）导入 <code>global.css</code>，该样式会被应用于应用里的每个路由：</p>
<pre><code class="language-javascript">// app/layout.js
import &#39;./global.css&#39;
 
export default function RootLayout({ children }) {
  return (
    &lt;html lang=&quot;en&quot;&gt;
      &lt;body&gt;{children}&lt;/body&gt;
    &lt;/html&gt;
  )
}
</code></pre>
<h2>4. 外部样式表</h2>
<p>你也可以通过导入外部包的方式添加样式，举个例子：</p>
<pre><code class="language-javascript">// app/layout.js
import &#39;bootstrap/dist/css/bootstrap.css&#39;
 
export default function RootLayout({ children }) {
  return (
    &lt;html lang=&quot;en&quot;&gt;
      &lt;body className=&quot;container&quot;&gt;{children}&lt;/body&gt;
    &lt;/html&gt;
  )
}
</code></pre>
<p>不过要注意，该外部包必须是从 npm 包直接导入或者下载完和你的代码放在一起。</p>
<p>如果我想引用外部 CDN CSS 文件呢？就比如<a href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css</a> 这种文件？</p>
<p>那你可以使用 <code>&lt;link&gt;</code> 标签添加在 Root Layout 中，就像这样：</p>
<pre><code class="language-jsx">// app/layout.js
import &quot;./globals.css&quot;;

export default function RootLayout({ children }) {
  return (
    &lt;html lang=&quot;en&quot;&gt;
      &lt;head&gt;
        &lt;link href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; /&gt;
      &lt;/head&gt;
      &lt;body&gt;{ children }&lt;/body&gt;
    &lt;/html&gt;
  );
}
</code></pre>
<p>使用样式的时候要注意：</p>
<p><strong>即时刷新：</strong> 在本地使用<code>next dev</code> 运行项目的时候，本地样式（无论是全局样式还是 CSS 模块），都会在你保存更改后立刻刷新，你可以即时看到样式变化。</p>
<p><strong>打包构建</strong> ：当使用 <code>next build</code> 的时候，CSS 文件会被打包成更少的压缩 <code>.css</code> 文件，这是为了减少网络请求，从而提高加载速度，所以不用担心创建多个 css 文件而影响了性能。</p>
<p><strong>禁用 JS：</strong> 当你禁用 JavaScript 的时候，在生产版本（<code>next start</code>），样式依然会被加载。也就是说，打包构建后的代码中的 CSS 并不是通过 JS 注入的。但是开发的时候（<code>next dev</code>），为了开启快速刷新，JavaScript 依然是有必要的。</p>
<h2>5. Tailwind CSS</h2>
<p><a href="https://tailwindcss.com/">Tailwind CSS</a> 是一个非常知名的 CSS 框架，本质是一个工具集，包含了大量比如 <code>flex</code>、<code>pt-4</code>、<code>text-center</code>、<code>rotate-90</code>等工具类，可以组合使用并直接在 HTML 代码上实现任何 UI 设计。与 Next.js 搭配使用非常顺手。Next.js 官方便是用的 Tailwind CSS。</p>
<p>在使用 <code>create-next-app</code>创建项目的时候，如果你在命令行中选择了使用 Tailwind CSS，则相关配置都会自动生成，可以直接使用。如果没有选择，希望引入 Tailwind CSS，可以参考此步骤。其实 Tailwind CSS 官方也提供了针对各个框架的<a href="https://tailwindcss.com/docs/installation/framework-guides">使用指南：</a></p>
<h3>5.1. 安装</h3>
<p>在项目根目录执行以下命令：</p>
<pre><code class="language-javascript">npm install -D tailwindcss postcss autoprefixer
npx tailwindcss init -p
</code></pre>
<p>会同时生成 <code>tailwind.config.js</code>和 <code>postcss.config.js</code>文件。</p>
<h3>5.2. 配置 Tailwind</h3>
<p><code>postcss.config.js</code> 不需要修改。在 <code>tailwind.config.js</code> 中添加使用 Tailwind CSS 类名的文件路径：</p>
<pre><code class="language-javascript">// tailwind.config.js
/** @type {import(&#39;tailwindcss&#39;).Config} */
module.exports = {
  content: [
    &#39;./app/**/*.{js,ts,jsx,tsx,mdx}&#39;,
    &#39;./pages/**/*.{js,ts,jsx,tsx,mdx}&#39;,
    &#39;./components/**/*.{js,ts,jsx,tsx,mdx}&#39;,
 
    // 嫌麻烦，你也可以直接使用 `src` 目录
    &#39;./src/**/*.{js,ts,jsx,tsx,mdx}&#39;,
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
</code></pre>
<h3>5.3. 导入样式</h3>
<p>添加 Tailwind CSS 指令，将 Tailwind 的样式注入到全局样式中。使用方式如下：</p>
<pre><code class="language-javascript">// app/globals.css
@tailwind base;
@tailwind components;
@tailwind utilities;
</code></pre>
<p>在根布局（<code>app/layout.tsx</code>），导入 <code>globals.css</code> ：</p>
<pre><code class="language-javascript">// app/layout.js 
import &#39;./globals.css&#39;
 
export const metadata = {
  title: &#39;Create Next App&#39;,
  description: &#39;Generated by create next app&#39;,
}
 
export default function RootLayout({ children }) {
  return (
    &lt;html lang=&quot;en&quot;&gt;
      &lt;body&gt;{children}&lt;/body&gt;
    &lt;/html&gt;
  )
}
</code></pre>
<h3>5.4. 使用类名</h3>
<p>然后你就可以在应用里使用 Tailwind 的工具类名：</p>
<pre><code class="language-javascript">// app/page.js
export default function Page() {
  return &lt;h1 className=&quot;text-3xl font-bold underline&quot;&gt;Hello, Next.js!&lt;/h1&gt;
}
</code></pre>
<h3>5.5. 辅助使用</h3>
<p>在 VSCode 中使用的时候，可以安装 <a href="https://marketplace.visualstudio.com/items?itemName=bradlc.vscode-tailwindcss">Tailwind CSS IntelliSense </a>这个插件，提供自动功能、语法校验、悬停预览等功能。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ad65001bb64441018aa46bc84fe6c6bf~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2080&h=1170&s=249225&e=png&b=1a1b26" alt="image.png"></p>
<p>Tailwind CSS 中的工具类众多，记不清的时候也可以查询这个<a href="https://tailwindcomponents.com/cheatsheet/">速查表</a>。</p>
<h2>6. CSS-in-JS</h2>
<h3>6.1. 介绍</h3>
<p>CSS-in-JS，顾名思义，将 CSS 写在 JS 文件里，而不是单独新建如 <code>.css</code>、<code>.scss</code>等文件。这样就可以在 CSS 中使用 JS 的变量定义、函数调用、条件判断等功能。</p>
<p>之所以能够流行，也跟 React、Vue 等框架的流行有关，“组件”的概念开始深入人心。因为 Vue 本身有自己的 CSS 方案，React 没有，所以 CSS-in-JS 也多在 React 社区中讨论。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a97658e259b4859859e32caa0c15c70~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1762&h=1560&s=483187&e=png&b=252325" alt="image.png"></p>
<p>实现 CSS-in-JS 的库有很多，每个库的实现、使用方式、语法也不尽相同。目前 Next.js 客户端组件中支持使用的库有：</p>
<ul>
<li><a href="https://kuma-ui.com/">kuma-ui</a></li>
<li><a href="https://mui.com/material-ui/guides/next-js-app-router/">@mui/material</a></li>
<li><a href="https://panda-css.com/">pandacss</a></li>
<li><a href="https://nextjs.org/docs/app/building-your-application/styling/css-in-js#styled-jsx">styled-jsx</a></li>
<li><a href="https://nextjs.org/docs/app/building-your-application/styling/css-in-js#styled-components">styled-components</a></li>
<li><a href="https://github.com/johanholmerin/style9">style9</a></li>
<li><a href="https://tamagui.dev/docs/guides/next-js#server-components">tamagui</a></li>
<li><a href="https://tss-react.dev/">tss-react</a></li>
<li><a href="https://github.com/vercel/next.js/tree/canary/examples/with-vanilla-extract">vanilla-extract</a></li>
</ul>
<p><a href="https://github.com/emotion-js/emotion/issues/2928">emotion</a> 正在支持中……</p>
<p>如果你希望设置服务端组件的样式，推荐使用 CSS 模块或者其他输出 CSS 文件的解决方案比如 PostCSS 或者 Tailwind CSS。</p>
<h3>6.2. 配置方式</h3>
<p>在 Next.js 中配置 CSS-in-JS 的基本原理分为三步：</p>
<ol>
<li>在渲染的时候有一个包含所有 CSS 规则的样式注册表</li>
<li>使用 <code>useServerInsertedHTML</code>hook 在内容被使用前注入样式规则</li>
<li>使用包含样式注册表的客户端组件包裹应用</li>
</ol>
<h3>6.3. styled-jsx</h3>
<p>这三步听起来有些复杂，让我们以 <code>styled-jsx</code> 为例进行讲解。注意在客户端组件使用 <code>styled-jsx</code>至少需要使用 <code>v5.1.0</code>版本。</p>
<p>首先创建一个新的注册表：</p>
<pre><code class="language-javascript">&#39;use client&#39;
// app/registry.js
import React, { useState } from &#39;react&#39;
import { useServerInsertedHTML } from &#39;next/navigation&#39;
import { StyleRegistry, createStyleRegistry } from &#39;styled-jsx&#39;
 
export default function StyledJsxRegistry({ children }) {
  const [jsxStyleRegistry] = useState(() =&gt; createStyleRegistry())
 
  useServerInsertedHTML(() =&gt; {
    const styles = jsxStyleRegistry.styles()
    jsxStyleRegistry.flush()
    return &lt;&gt;{styles}&lt;/&gt;
  })
 
  return &lt;StyleRegistry registry={jsxStyleRegistry}&gt;{children}&lt;/StyleRegistry&gt;
}
</code></pre>
<p>然后用此包含注册表的组件包裹根组件的 <code>children</code>：</p>
<pre><code class="language-javascript">// app/layout.js
import StyledJsxRegistry from &#39;./registry&#39;
 
export default function RootLayout({ children }) {
  return (
    &lt;html&gt;
      &lt;body&gt;
        &lt;StyledJsxRegistry&gt;{children}&lt;/StyledJsxRegistry&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  )
}
</code></pre>
<p>然后你就可以在 <code>page.js</code> 中使用：</p>
<pre><code class="language-jsx">export default function Page() {
  return (
    &lt;div&gt;
      &lt;div className=&quot;container&quot;&gt;text
      &lt;/div&gt;

      &lt;style jsx&gt;{`
        .container {
          display: grid;
          grid-template-columns: repeat(1, minmax(0, 1fr));
          gap: 1.5rem /* 24px */;
        }

        @media (min-width: 1024px) {
          .container {
            grid-template-columns: repeat(3, minmax(0, 1fr));
          }
        }
      `}&lt;/style&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<p>示例代码地址：<a href="https://github.com/vercel/app-playground/tree/main/app/styling/styled-jsx">https://github.com/vercel/app-playground/tree/main/app/styling/styled-jsx</a></p>
<h3>6.4. Styled Components</h3>
<p>Styled Components 的配置也大致如此，注意使用 <code>styled-components@6</code> 或者更高版本。</p>
<p>首先，创建一个全局注册表：</p>
<pre><code class="language-javascript">&#39;use client&#39;
// lib/registry.js
import React, { useState } from &#39;react&#39;
import { useServerInsertedHTML } from &#39;next/navigation&#39;
import { ServerStyleSheet, StyleSheetManager } from &#39;styled-components&#39;
 
export default function StyledComponentsRegistry({ children }) {
  const [styledComponentsStyleSheet] = useState(() =&gt; new ServerStyleSheet())
 
  useServerInsertedHTML(() =&gt; {
    const styles = styledComponentsStyleSheet.getStyleElement()
    styledComponentsStyleSheet.instance.clearTag()
    return &lt;&gt;{styles}&lt;/&gt;
  })
 
  if (typeof window !== &#39;undefined&#39;) return &lt;&gt;{children}&lt;/&gt;
 
  return (
    &lt;StyleSheetManager sheet={styledComponentsStyleSheet.instance}&gt;
      {children}
    &lt;/StyleSheetManager&gt;
  )
}
</code></pre>
<p>然后用此包含注册表的组件包裹根组件的 <code>children</code>：</p>
<pre><code class="language-javascript">// app/layout.js
import StyledComponentsRegistry from &#39;./lib/registry&#39;
 
export default function RootLayout({ children }) {
  return (
    &lt;html&gt;
      &lt;body&gt;
        &lt;StyledComponentsRegistry&gt;{children}&lt;/StyledComponentsRegistry&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  )
}
</code></pre>
<p>然后你就可以在 page.js 中使用：</p>
<pre><code class="language-javascript">&#39;use client&#39;;

import styled from &#39;styled-components&#39;;

const Container = styled.div`
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 1.5rem /* 24px */;
`;

const SkeletonInner = styled.div`
  padding: 1rem /* 16px */;
  background-color: rgb(24 24 27 / 0.8);
  border-radius: 1rem /* 16px */;
`;

const SkeletonImg = styled.div`
  height: 3.5rem /* 56px */;
  border-radius: 0.5rem /* 8px */;
  background-color: rgb(63 63 70 / 1);
`;

const SkeletonBtn = styled.div`
  margin-top: 0.75rem /* 12px */;
  width: 25%;
  height: 0.75rem /* 12px */;
  border-radius: 0.5rem /* 8px */;
  background-color: rgb(255 0 128 / 1);
`;

const Skeleton = () =&gt; (
  &lt;SkeletonInner&gt;
    &lt;SkeletonImg /&gt;
    &lt;SkeletonBtn /&gt;
  &lt;/SkeletonInner&gt;
);

export default function Page() {
  return (
    &lt;div className=&quot;space-y-4&quot;&gt;
      &lt;h1 className=&quot;text-xl font-medium text-gray-400/80&quot;&gt;
        Styled with Styled Components
      &lt;/h1&gt;
      &lt;Container&gt;
        &lt;Skeleton /&gt;
        &lt;Skeleton /&gt;
        &lt;Skeleton /&gt;
      &lt;/Container&gt;
    &lt;/div&gt;
  );
}
</code></pre>
<p>示例代码地址：<a href="https://github.com/vercel/app-playground/tree/main/app/styling/styled-components">https://github.com/vercel/app-playground/tree/main/app/styling/styled-components</a></p>
<h2>7. Sass</h2>
<h3>7.1. Sass 使用</h3>
<p>Sass 作为知名的 CSS 预处理器已无须过多介绍。Next.js 内置了对 Sass 文件的支持，你需要使用 <code>.scss</code>和 <code>.sass</code>作为文件后缀。</p>
<p>你也可以结合 CSS 模块使用组件级别的 Sass， 你需要使用<code>.module.scss</code>或者 <code>.module.sass</code>作为文件后缀。</p>
<p>使用 sass，你需要首先安装 <a href="https://github.com/sass/sass">sass</a>：</p>
<pre><code class="language-javascript">npm install --save-dev sass
</code></pre>
<h3>7.2. 自定义配置</h3>
<p>如果你希望配置 Sass 编译器，使用 <code>next.config.js</code> 的 <code>sassOptions</code>选项：</p>
<pre><code class="language-javascript">// next.config.js
const path = require(&#39;path&#39;)
 
module.exports = {
  sassOptions: {
    includePaths: [path.join(__dirname, &#39;styles&#39;)],
  },
}
</code></pre>
<h3>7.3 Sass 变量</h3>
<p>Next.js 支持从 CSS 模块文件导出 Sass 变量。这是一个示例代码：</p>
<pre><code class="language-javascript">// app/variables.module.scss
$primary-color: #64ff00;
 
:export {
  primaryColor: $primary-color;
}
</code></pre>
<pre><code class="language-javascript">// app/page.js
// maps to root `/` URL
 
import variables from &#39;./variables.module.scss&#39;
 
export default function Page() {
  return &lt;h1 style={{ color: variables.primaryColor }}&gt;Hello, Next.js!&lt;/h1&gt;
}
</code></pre>
<h2>参考链接</h2>
<ol>
<li><a href="https://nextjs.org/docs/app/building-your-application/styling/css-modules">Styling: CSS Modules</a></li>
<li><a href="https://nextjs.org/docs/app/building-your-application/styling/tailwind-css">Styling: Tailwind CSS</a></li>
<li><a href="https://nextjs.org/docs/app/building-your-application/styling/css-in-js">Styling: CSS-in-JS</a></li>
<li><a href="https://nextjs.org/docs/app/building-your-application/styling/sass">Styling: Sass</a></li>
<li><a href="https://2023.stateofcss.com/zh-Hans/css-in-js/">State of CSS 2023: CSS-in-JS</a></li>
</ol>

</body>
</html>
  