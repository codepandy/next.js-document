
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>37-实战篇  React Notes  项目介绍与创建</title>
  <style>
    body {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
    }
    pre {
      background-color: #f6f8fa;
      padding: 16px;
      border-radius: 6px;
      overflow: auto;
    }
    code {
      font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
    }
  </style>
</head>
<body>
<h2>前言</h2>
<p>欢迎来到实战篇！基础篇的目标是带大家复习基础知识，以及用作使用手册，方便大家在以后的项目开发中查询 API 用法，属于这本小册的“赠送面积”。从本篇起就进入小册的正式内容了。</p>
<p>我们的第一个实战项目是 <strong>React Notes</strong>，因为 Next.js v14 基于 React Server Component 构建的 App Router，而 React Server Component 的起源是 2020 年 12 月 21 日 React 官方发布的关于 React Server Components 的<a href="https://legacy.reactjs.org/blog/2020/12/21/data-fetching-with-react-server-components.html">介绍文章</a>。</p>
<p>这篇文章同时配上了由 Dan Abramov 和 Lauren Tan 两位 React 团队的工程师分享的长约 1h 的<a href="https://www.youtube.com/watch?time_continue=15&v=TQQPAU21ZUw&embeds_referring_euri=https%3A%2F%2Flegacy.reactjs.org%2F&source_ve_path=MzY4NDIsMzY4NDIsMzY4NDIsMzY4NDIsMzY4NDIsMzY4NDIsMzY4NDIsMjg2NjY&feature=emb_logo">演讲</a>和 <a href="https://github.com/reactjs/server-components-demo">Demo</a>，详细的介绍了 React Server Components 的出现背景和使用方式（这是这个 Demo 的一个<a href="https://stackblitz.com/edit/react-server-components-demo-u57n2t?file=README.md">线上工程</a>，你可以在这个地址上调试学习）。</p>
<p>当时这个 <a href="https://github.com/reactjs/server-components-demo">Demo</a> 就是 <strong>React Notes</strong>，实战篇的第一个项目从这个“起源 Demo”开始讲起，既是一种追溯致敬，也是为了帮助大家在实战中体会 React Server Component 的特性和优势，毕竟当时 React 的工程师写了这个 Demo 用于新特性的展示，自然是要覆盖它的各种用法和特性。</p>
<p>这个 Demo 中的 Server 是自己写的，数据库用的是 PostgreSQL，如果要本地预览原本的 Demo 效果，参照 Demo 的介绍，本地安装 PostgreSQL，创建数据库，连接数据库，再运行项目即可成功开启。这里具体的实现步骤就不多讲了，反正我们的实战篇会用 Next.js 重新实现这个项目。</p>
<h2>需求文档</h2>
<p>先让我介绍下 React Notes 的项目效果，正如它的名字表明的那样，这是一个笔记系统，可以增删改查笔记，笔记支持 markdown 格式。</p>
<p>首页效果如下，界面分为两列，左侧是笔记列表，右侧是笔记内容：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/081f4269b85447a0ae044465ea9fa2f4~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=3076&h=1570&s=258799&e=png&b=f4f6f9" alt="image.png"></p>
<p>点击左边的 <code>New</code> 按钮，可以增加一个 Note，增加后，左侧笔记列表也会同时更新：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3411f724c4eb4d1997311f245723df14~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1191&h=720&s=108873&e=gif&f=42&b=f4f6f9" alt="React Notes 增加.gif"></p>
<p>在编辑的时候，也可以删除一个 Note，删除后左侧笔记列表也会同时更新：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dad06db2883947c288dc871c769db98b~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1209&h=892&s=166272&e=gif&f=32&b=fefefe" alt="React Notes 删除.gif"></p>
<p>可以对现有的 Note 进行修改：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/769756f0159a465097938e39a0eac2de~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1209&h=892&s=113504&e=gif&f=44&b=fefefe" alt="React Notes 修改.gif"></p>
<p>还可以在左侧用搜索框查找一个 Note：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f2111a45e641438daab0ae9d3394dc90~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1209&h=892&s=324795&e=gif&f=91&b=f6f8fa" alt="React Notes 查找.gif"></p>
<p>看起来效果是不是平平无奇？但是注意一点，在这个例子中，我们先在左侧笔记列表中展开了一个笔记，然后又新建了一个笔记，在新建后，左侧笔记列表刷新，但展开的笔记依然保持了之前的状态。</p>
<h2>技术文档</h2>
<p>现在我们要用 Next.js 实现这个项目，该怎么实现呢？</p>
<p>首先是技术选型，Next.js 的 App Router 自然是要用的，TypeScript 为了减少代码展示量就不使用了，ESLint 要使用，用于校验代码，Tailwind CSS 不需要，因为重写样式浪费时间，我们直接导入原 Demo 的样式文件即可。</p>
<p>后端数据库选择什么都可以，不过考虑到初期大家对 Next.js 尤其是 App Router 的使用不太习惯，再加上数据库的安装和使用也需要额外学习，我们先集中学习如何写好 Next.js 项目，数据方面先使用模拟数据来实现。</p>
<p>那么新的问题来了，怎么写模拟数据呢？第一种方式是在代码里直接写入数据。第二种方式是使用比如 faskMock 这样的工具生成静态接口。但是我们毕竟要做增删改查，无论是直接写数据还是静态接口都难以实现真的对数据源进行修改，所以最后我想了下，干脆用 <a href="https://redis.io/">Redis</a> 做好了，作为经典的 NoSQL 数据库，使用起来也很方便。等 Next.js 部分完成学习之后，我们再替换为其他数据库。（其实我还试了用<a href="https://developers.vika.cn/api/introduction">维格表</a>做数据库，但维格表接口有每秒最多 2 次的限制，于是就放弃了）</p>
<p>其次是路由分析，原 Demo 中都是在 <code>localhost:4000</code>下实现的，各种操作并不会产生路由变化，但既然我们用了 Next.js，不妨改成使用路由的方式，想了下，应该有这样几个路由：</p>
<ol>
<li>首页肯定是 <code>/</code>，点击左上角的 React Note Logo 会导航至首页 <code>/</code></li>
<li>点击左侧笔记列表中的一项，导航至 <code>/note/xxxx</code>路由，渲染具体笔记内容</li>
<li>当点击 <code>NEW</code> 按钮的时候导航到 <code>/note/edit</code>路由上，点击 <code>Done</code>导航至刚创建的 <code>/note/xxxx</code>路由</li>
<li>导航至 <code>/note/xxxx</code>后，点击 <code>EDIT</code> 按钮，进入 <code>/note/edit/xxxx</code> 路由，点击 <code>Done</code>导航至刚修改的 <code>/note/xxxx</code>路由，点击 <code>DELETE</code> 导航至首页 <code>/</code></li>
<li>当在左侧搜索框输入字符的时候，对应路由添加 <code>?q=searchText</code> 参数</li>
</ol>
<p>对应到 Next.js 的项目目录，至少要有这些文件：</p>
<pre><code class="language-javascript">next-react-notes                 
├─ app                                     
│  ├─ note                       
│  │  ├─ [id]                         
│  │  │  └─ page.js              
│  │  └─ edit                    
│  │     ├─ [id]                 
│  │     │  └─ page.js              
│  │     └─ page.js                        
│  ├─ layout.js                  
│  └─ page.js                                
</code></pre>
<p>考虑到左侧笔记列表出现在所有的路由中，我们将左侧的内容包括搜索栏和笔记列表，统一放在根布局 <code>layout.js</code> 中。</p>
<p>再者是组件划分，示意图如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0ce14cd1fd74018ac9e956d1da4864f~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2450&h=1740&s=147434&e=png&b=ffffff" alt="截屏2023-12-14 下午4.08.38.png"></p>
<p>左侧是 <code>&lt;Sidebar&gt;</code> 组件，子组件中有：</p>
<ol>
<li><code>&lt;SidebarSearchField&gt;</code> 组件负责搜索框</li>
<li><code>&lt;EditButton&gt;</code> 组件负责添加按钮</li>
<li><code>&lt;SidebarNoteList&gt;</code> 组件负责笔记列表<ol>
<li>再拆分为具体的 <code>&lt;SidebarNoteItem&gt;</code> 组件负责每一条具体的笔记内容</li>
</ol>
</li>
</ol>
<p>右侧是 <code>&lt;Note&gt;</code> 组件，子组件有：</p>
<ol>
<li><code>&lt;EditButton&gt;</code> 组件负责编辑按钮</li>
<li><code>&lt;NoteEditor&gt;</code> 组件负责笔记的编辑界面</li>
<li><code>&lt;NotePreview&gt;</code> 组件负责笔记的预览界面</li>
</ol>
<p>对项目有了大致的了解和规划，剩下的就让我们在项目里具体完善吧，现在开始动手吧。</p>
<h2>开始项目</h2>
<h3>1. 创建项目</h3>
<p>使用 <code>create-next-app</code>脚手架<a href="https://juejin.cn/book/7307859898316881957/section/7307280276332544027#heading-1">创建项目</a>，运行：</p>
<pre><code class="language-bash">npx create-next-app@latest
</code></pre>
<p>相关选择如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fb2ac654862f445fb9146ce39caba318~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1150&h=328&s=618397&e=png&b=0b141d" alt="image.png"></p>
<p>运行 <code>npm run dev</code>，打开 <code>localhost: 3000</code>开启项目：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/60cd55caf07d46ab9832700283dd1f3d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2034&h=1490&s=294221&e=png&b=000000" alt="image.png"></p>
<h3>2. 配置路径别名</h3>
<p>为了让代码文件职责清晰，我们将组件统一放在根目录下的 <code>components</code>目录下，工具库放在根目录下的 <code>lib</code>目录下，为了方便引入，我们配置一下<a href="https://juejin.cn/book/7307859898316881957/section/7309078454316564507#heading-13">路径别名</a>，修改 <code>jsconfig.json</code>：</p>
<pre><code class="language-javascript">{
  &quot;compilerOptions&quot;: {
    &quot;paths&quot;: {
      &quot;@/components/*&quot;: [&quot;components/*&quot;],
      &quot;@/lib/*&quot;: [&quot;lib/*&quot;]
    }
  }
}
</code></pre>
<h3>3. 修改根布局和根页面</h3>
<p>修改 <code>app/page.js</code>：</p>
<pre><code class="language-javascript">// app/page.js
export default async function Page() {
  return (
    &lt;div className=&quot;note--empty-state&quot;&gt;
      &lt;span className=&quot;note-text--empty-state&quot;&gt;
        Click a note on the left to view something! 🥺
      &lt;/span&gt;
    &lt;/div&gt;
  )
}
</code></pre>
<p>修改 <code>app/layout.js</code>：</p>
<pre><code class="language-javascript">import &#39;./style.css&#39;
import Sidebar from &#39;@/components/Sidebar&#39;

export default async function RootLayout({
  children
}) {

  return (
    &lt;html lang=&quot;en&quot;&gt;
      &lt;body&gt;
        &lt;div className=&quot;container&quot;&gt;
          &lt;div className=&quot;main&quot;&gt;
            &lt;Sidebar /&gt;
            &lt;section className=&quot;col note-viewer&quot;&gt;{children}&lt;/section&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  )
}
</code></pre>
<p>在 <code>/components</code>下新建一个名为 <code>Sidebar.js</code> 的文件，代码为：</p>
<pre><code class="language-javascript">import React from &#39;react&#39;
import Link from &#39;next/link&#39;

export default async function Sidebar() {
  return (
    &lt;&gt;
      &lt;section className=&quot;col sidebar&quot;&gt;
        &lt;Link href={&#39;/&#39;} className=&quot;link--unstyled&quot;&gt;
          &lt;section className=&quot;sidebar-header&quot;&gt;
            &lt;img
              className=&quot;logo&quot;
              src=&quot;/logo.svg&quot;
              width=&quot;22px&quot;
              height=&quot;20px&quot;
              alt=&quot;&quot;
              role=&quot;presentation&quot;
            /&gt;
            &lt;strong&gt;React Notes&lt;/strong&gt;
          &lt;/section&gt;
        &lt;/Link&gt;
        &lt;section className=&quot;sidebar-menu&quot; role=&quot;menubar&quot;&gt;
            {/* SideSearchField */}
        &lt;/section&gt;
        &lt;nav&gt;
          {/* SidebarNoteList */}
        &lt;/nav&gt;
      &lt;/section&gt;
    &lt;/&gt;
  )
}
</code></pre>
<h3>4. 引入所需样式和图片文件</h3>
<p>在根布局里我们引用了 <code>style.css</code>，<code>style.css</code>里声明了所有的样式，但这个文件不需要我们自己写，因为<a href="https://github.com/reactjs/server-components-demo/tree/main">原 Demo</a> 里就已经将所有的样式写到了一个 <a href="https://github.com/reactjs/server-components-demo/blob/main/public/style.css">style.css</a> 文件，我们只需要将这个文件拷贝到 <code>app</code>目录下即可。</p>
<p>这个项目里还会用到一些图片，我们将原 Demo 里 <a href="https://github.com/reactjs/server-components-demo/tree/main/public">public 目录</a>下的 5 张 SVG 图片：<code>checkmark.svg</code>、<code>chevron-down.svg</code>、<code>chevron-up.svg</code>、<code>cross.svg</code>、<code>logo.svg</code> 拷贝到 <code>public</code>目录下。</p>
<h3>5. 第一步完成！</h3>
<p>如果步骤正确的话，此时再访问 <code>http://localhost:3000/</code>应该效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6752f40eba614c99a75c1e0e67cff120~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1736&h=1132&s=100291&e=png&b=f6f7fa" alt="image.png"></p>
<p>是不是有原 Demo 的样子了？</p>
<h2>数据请求</h2>
<p>现在我们来处理数据的问题，正如之前所说，为了方便起见，我们使用 Redis 做数据库。简单介绍一下 Redis，它是一个高性能的 key-value  数据库，是现在最受欢迎的 NoSQL 数据库之一，常用于缓存、计数器、消息队列系统、排行榜等场景。</p>
<p>使用 Redis 很简单，一共分为三步：</p>
<h3>1. 安装 Redis</h3>
<p>macOS 安装 redis 很简单，按照<a href="https://redis.io/docs/install/install-redis/install-redis-on-mac-os/">官网安装说明</a>，使用 Homebrew 安装即可：</p>
<pre><code class="language-bash">brew install redis
</code></pre>
<p>Windows 安装略微复杂一点，因为我手边没有 Windows 电脑，就不提供安装方法了，教程很多。</p>
<h3>2. 启动 Redis</h3>
<p>运行以下命令，如果出现下图界面即表示运行成功：</p>
<pre><code class="language-bash">redis-server
</code></pre>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fd716fcce111422697241f8463989a52~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2022&h=1094&s=3147360&e=png&b=03080d" alt="image.png"></p>
<h3>3. 项目引入 Redis</h3>
<p>在项目里使用 redis 的时候，我们借助 <a href="https://github.com/redis/ioredis">ioredis</a> 这个库，安装 ioredis：</p>
<pre><code class="language-bash">npm install ioredis
</code></pre>
<p>在根目录下新建一个 <code>lib</code>文件夹，在 <code>lib</code>下新建一个名为 <code>redis.js</code>的文件，代码如下：</p>
<pre><code class="language-javascript">import Redis from &#39;ioredis&#39;

const redis = new Redis()

const initialData = {
  &quot;1702459181837&quot;: &#39;{&quot;title&quot;:&quot;sunt aut&quot;,&quot;content&quot;:&quot;quia et suscipit suscipit recusandae&quot;,&quot;updateTime&quot;:&quot;2023-12-13T09:19:48.837Z&quot;}&#39;,
  &quot;1702459182837&quot;: &#39;{&quot;title&quot;:&quot;qui est&quot;,&quot;content&quot;:&quot;est rerum tempore vitae sequi sint&quot;,&quot;updateTime&quot;:&quot;2023-12-13T09:19:48.837Z&quot;}&#39;,
  &quot;1702459188837&quot;: &#39;{&quot;title&quot;:&quot;ea molestias&quot;,&quot;content&quot;:&quot;et iusto sed quo iure&quot;,&quot;updateTime&quot;:&quot;2023-12-13T09:19:48.837Z&quot;}&#39;
}

export async function getAllNotes() {
  const data = await redis.hgetall(&quot;notes&quot;);
  if (Object.keys(data).length == 0) {
    await redis.hset(&quot;notes&quot;, initialData);
  }
  return await redis.hgetall(&quot;notes&quot;)
}

export async function addNote(data) {
  const uuid = Date.now().toString();
  await redis.hset(&quot;notes&quot;, [uuid], data);
  return uuid
}

export async function updateNote(uuid, data) {
  await redis.hset(&quot;notes&quot;, [uuid], data);
}

export async function getNote(uuid) {
  return JSON.parse(await redis.hget(&quot;notes&quot;, uuid));
}

export async function delNote(uuid) {
  return redis.hdel(&quot;notes&quot;, uuid)
}

export default redis
</code></pre>
<p>这块代码并不复杂，我们导出了 5 个函数，表示 5 个用于前后端交互的接口，分别是：</p>
<ol>
<li>获取所有笔记的 getAllNotes，这里我们做了一个特殊处理，如果为空，就插入 3 条事先定义的笔记数据</li>
<li>添加笔记的 addNote</li>
<li>更新笔记的 updateNote</li>
<li>获取笔记的 updateNote</li>
<li>删除笔记的 delNote</li>
</ol>
<p>其中我们使用了 ioredis 的 hash 结构（ioredis 提供了相关<a href="https://github.com/redis/ioredis/blob/main/examples/hash.js">写法示例</a>和 <a href="https://redis.github.io/ioredis/classes/Redis.html">API 说明</a>）。也就是说，我们在 redis 服务器中存储的数据大概长这样：</p>
<pre><code class="language-javascript">{
  &quot;1702459181837&quot;: &#39;{&quot;title&quot;:&quot;sunt aut&quot;,&quot;content&quot;:&quot;quia et suscipit suscipit recusandae&quot;,&quot;updateTime&quot;:&quot;2023-12-13T09:19:48.837Z&quot;}&#39;,
  &quot;1702459182837&quot;: &#39;{&quot;title&quot;:&quot;qui est&quot;,&quot;content&quot;:&quot;est rerum tempore vitae sequi sint&quot;,&quot;updateTime&quot;:&quot;2023-12-13T09:19:48.837Z&quot;}&#39;,
  &quot;1702459188837&quot;: &#39;{&quot;title&quot;:&quot;ea molestias&quot;,&quot;content&quot;:&quot;et iusto sed quo iure&quot;,&quot;updateTime&quot;:&quot;2023-12-13T09:19:48.837Z&quot;}&#39;
}
</code></pre>
<p>使用 macOS 的同学可以再下载一个 <a href="https://getmedis.com/">Medis</a>，用于查看 Redis 中的数据（当然此时 Redis 还没有写入这些数据）：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8aae8a72646348fdb715e742f1e3cf1e~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2680&h=1644&s=638727&e=png&a=1&b=252729" alt="image.png"></p>
<p>其中，key 值用的是创建笔记时的时间戳，value 值是具体的笔记数据，分为 3 个字段，分别是 <code>title</code>、<code>content</code>、<code>updateTime</code>。</p>
<h2>Sidebar 组件</h2>
<p>现在让我们用此数据接口来写左侧的笔记列表吧！</p>
<h3>1. 笔记列表</h3>
<p>修改 <code>components/Sidebar.js</code>：</p>
<pre><code class="language-jsx">import React from &#39;react&#39;
import Link from &#39;next/link&#39;
import { getAllNotes } from &#39;@/lib/redis&#39;;
import SidebarNoteList from &#39;@/components/SidebarNoteList&#39;;

export default async function Sidebar() {
  const notes = await getAllNotes()
  return (
    &lt;&gt;
      &lt;section className=&quot;col sidebar&quot;&gt;
        &lt;Link href={&#39;/&#39;} className=&quot;link--unstyled&quot;&gt;
          &lt;section className=&quot;sidebar-header&quot;&gt;
            &lt;img
              className=&quot;logo&quot;
              src=&quot;/logo.svg&quot;
              width=&quot;22px&quot;
              height=&quot;20px&quot;
              alt=&quot;&quot;
              role=&quot;presentation&quot;
              /&gt;
            &lt;strong&gt;React Notes&lt;/strong&gt;
          &lt;/section&gt;
        &lt;/Link&gt;
        &lt;section className=&quot;sidebar-menu&quot; role=&quot;menubar&quot;&gt;
          {/* SideSearchField */}
        &lt;/section&gt;
        &lt;nav&gt;
          &lt;SidebarNoteList notes={notes} /&gt;
        &lt;/nav&gt;
      &lt;/section&gt;
    &lt;/&gt;
  )
}
</code></pre>
<p>在代码中，我们将笔记列表抽成了单独的 <code>components/SidebarNoteList.js</code>组件，代码如下：</p>
<pre><code class="language-jsx">export default async function NoteList({ notes }) {

  const arr = Object.entries(notes);

  if (arr.length == 0) {
    return &lt;div className=&quot;notes-empty&quot;&gt;
      {&#39;No notes created yet!&#39;}
    &lt;/div&gt;
  }

  return &lt;ul className=&quot;notes-list&quot;&gt;
    {arr.map(([noteId, note]) =&gt; {
    const { title, updateTime } = JSON.parse(note);
    return &lt;li key={noteId}&gt;
      &lt;header className=&quot;sidebar-note-header&quot;&gt;
        &lt;strong&gt;{title}&lt;/strong&gt;
        &lt;small&gt;{updateTime}&lt;/small&gt;
      &lt;/header&gt;
    &lt;/li&gt;
  })}
  &lt;/ul&gt;
}
</code></pre>
<p>如果步骤正确的话，此时再访问 <code>http://localhost:3000/</code>应该效果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c9907e43c6f14b308a31d1ebddd11b66~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1746&h=990&s=139551&e=png&b=f6f7fa" alt="image.png"></p>
<p>我们已经成功的获取了 Redis 数据库中的数据，然后服务端渲染到了页面上。</p>
<p>现在在 Medis 中应该已经可以查看到写入的数据：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1bd5a4a1c4d14aeea990ca4c239c6226~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2680&h=1644&s=638727&e=png&a=1&b=252729" alt="image.png"></p>
<p>现在你在 Medis 中修改下数据，<code>http://localhost:3000/</code>刷新后也会展示出来。</p>
<h3>2. 时间处理库</h3>
<p>现在你会发现，左侧笔记列表中的时间展示非常“难看”，为此我们需要一个将时间格式化的库，这里我们选择大家经常会用到的 <a href="https://dayjs.gitee.io/zh-CN/">Day.js</a>，安装一下：</p>
<pre><code class="language-bash">npm install dayjs
</code></pre>
<p>修改 <code>SidebarNoteList.js</code>：</p>
<pre><code class="language-javascript">import dayjs from &#39;dayjs&#39;;

export default async function NoteList({ notes }) {

  const arr = Object.entries(notes);

  if (arr.length == 0) {
    return &lt;div className=&quot;notes-empty&quot;&gt;
      {&#39;No notes created yet!&#39;}
    &lt;/div&gt;
  }

  return &lt;ul className=&quot;notes-list&quot;&gt;
    {arr.map(([noteId, note]) =&gt; {
      const { title, updateTime } = JSON.parse(note);
      return &lt;li key={noteId}&gt;
        &lt;header className=&quot;sidebar-note-header&quot;&gt;
          &lt;strong&gt;{title}&lt;/strong&gt;
          &lt;small&gt;{dayjs(updateTime).format(&#39;YYYY-MM-DD hh:mm:ss&#39;)}&lt;/small&gt;
        &lt;/header&gt;
      &lt;/li&gt;
    })}
  &lt;/ul&gt;
}
</code></pre>
<p>时间效果展示如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/387c82dde3384009a47671aa2918ff38~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1740&h=922&s=126371&e=png&b=f6f7fa" alt="image.png"></p>
<p>是不是好看多了？但其实效果并不重要，重要的是我们引用了 <code>day.js</code> 这个库。我们引入 <code>day.js</code> 的 SidebarNoteList 组件使用的是服务端渲染，这意味着 <code>day.js</code> 的代码并不会被打包到客户端的 bundle 中。我们查看开发者工具中的源代码：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b8254999ba64c4bad1ff63ef2c0c621~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2492&h=1010&s=207391&e=png&b=f6f7fa" alt="截屏2023-12-14 下午10.56.02.png"></p>
<p>你会发现 node_modules 并没有 day.js，但如果你现在在 SidebarNoteList 组件的顶部添加 <code>&#39;use client&#39;</code>，声明为客户端组件，你会发现立刻就多了 day.js：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/037b4091549a45bd9457361eced21579~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2494&h=990&s=210227&e=png&b=f6f7fa" alt="截屏2023-12-14 下午10.59.07.png"></p>
<h3>3. 最佳实践：多用服务端组件</h3>
<p>这就是使用 React Server Compoent 的好处之一，服务端组件的代码不会打包到客户端的 bundle 中：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/588f2f2a57b545f3a247ffcd27a6aa81~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1500&h=573&s=216155&e=png&b=1b1c24" alt="image.png"></p>
<h2>总结</h2>
<p>那么今天的内容就结束了，本篇我们大致知道了要做的项目内容，并新建了 Next.js 项目，学会了用 Redis 做个简易的数据库，最后通过引入时间处理库，了解了使用 React Server Component 的一个优势。</p>
<p>本篇的代码我已经上传到<a href="https://github.com/mqyqingfeng/next-react-notes-demo/tree/main">代码仓库</a>的 Day1 分支：<a href="https://github.com/mqyqingfeng/next-react-notes-demo/tree/day1">https://github.com/mqyqingfeng/next-react-notes-demo/tree/day1</a>，直接使用的时候不要忘记在本地开启 Redis。</p>
<h2>参考链接</h2>
<ol>
<li><a href="https://github.com/reactjs/server-components-demo">https://github.com/reactjs/server-components-demo</a></li>
<li><a href="https://www.youtube.com/watch?v=TQQPAU21ZUw&t=15s&ab_channel=MetaOpenSource">https://www.youtube.com/watch?v=TQQPAU21ZUw&amp;t=15s&amp;ab_channel=MetaOpenSource</a></li>
<li><a href="https://redis.io/docs/install/install-redis/install-redis-on-mac-os/">https://redis.io/docs/install/install-redis/install-redis-on-mac-os/</a></li>
</ol>

</body>
</html>
  