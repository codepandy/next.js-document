
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>54-å®æˆ˜ç¯‡  åšå®¢  æ·±è‰²æ¨¡å¼ï¼ˆDark Modeï¼‰</title>
  <style>
    body {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
    }
    pre {
      background-color: #f6f8fa;
      padding: 16px;
      border-radius: 6px;
      overflow: auto;
    }
    code {
      font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
    }
  </style>
</head>
<body>
<h2>å‰è¨€</h2>
<p>æœ¬ç¯‡æˆ‘ä»¬æ¥å®ç°æ·±è‰²æ¨¡å¼ã€‚å®ƒä¹Ÿè¢«å«åšæš—é»‘æ¨¡å¼ã€é»‘å¤œæ¨¡å¼ç­‰ç­‰ã€‚è¿™é‡Œæˆ‘ä»¬é€‰ç”¨çš„æ˜¯è‹¹æœå®˜æ–¹æ–‡æ¡£çš„ç¿»è¯‘ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/42e0a67dbaec435d9b2efd47a3531122~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=2104&h=616&s=266452&e=png&b=fdfdfd" alt="image.png"></p>
<h2>1. æ·±è‰²æ¨¡å¼</h2>
<p>â€œæ·±è‰²æ¨¡å¼â€æœ¬è´¨ä¸Šæ˜¯ä¸€å¥—é‡‡ç”¨æ·±è‰²èƒŒæ™¯ã€æµ…è‰²æ–‡æ¡ˆçš„é…è‰²æ–¹æ¡ˆã€‚å…¶å®å¾ˆæ—©å°±æœ‰ã€‚ç°åœ¨è¶Šæ¥è¶Šæµè¡Œï¼Œæ˜¯å› ä¸ºè‹¹æœåœ¨ 2018 å¹´æå‡ºäº†è¿™ä¸€æ¦‚å¿µã€‚</p>
<p>å…ˆæ˜¯ 2018 å¹´çš„ macOS Mojave ç‡å…ˆæ”¯æŒäº†æ·±è‰²å¤–è§‚ï¼Œç„¶å 2019 å¹´ IOS 13 æ­£å¼æ”¯æŒæ·±è‰²å¤–è§‚ã€‚è¿™äº›éƒ½æ˜¯ç³»ç»Ÿçº§åˆ«çš„æ”¯æŒï¼Œå¯ä»¥å°†æ•´ä¸ªç³»ç»Ÿçš„ç•Œé¢åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼ã€‚ç”±æ­¤æ·±è‰²æ¨¡å¼å¼€å§‹è¿›å…¥äººä»¬çš„è§†é‡ï¼Œæˆä¸ºè®¾è®¡å¸ˆã€å‰ç«¯å·¥ç¨‹å¸ˆçš„å­¦ä¹ å†…å®¹â€¦â€¦</p>
<p>ä½¿ç”¨æ·±è‰²æ¨¡å¼ä¹Ÿç¡®å®æœ‰ä¸€äº›å¥½å¤„ï¼š</p>
<ol>
<li>ä¿æŠ¤è§†åŠ›ã€‚æ¯•ç«Ÿæ™šä¸Šçš„æ—¶å€™ï¼Œæµ…è‰²æœ‰äº›åˆºçœ¼ã€‚</li>
<li>å¢åŠ æ²‰æµ¸æ„Ÿã€‚é˜…è¯»æµè§ˆç±» App æˆ–æ˜¯å†…å®¹åˆ›ä½œå‹ Appï¼ˆæ¯”å¦‚ä»£ç ç¼–è¾‘å™¨ï¼‰å¾€å¾€ä¼šä½¿ç”¨æ·±è‰²æ¨¡å¼ï¼Œå®ƒä»¬ä¼šå€ŸåŠ©é»‘åº•ç™½å­—çš„é«˜å¯¹æ¯”åº¦ç‰¹æ€§è®©ç”¨æˆ·è§†çº¿ä¿æŒé›†ä¸­ã€‚æ‰€ä»¥åˆ‡æ¢æ·±è‰²æ¨¡å¼åï¼Œå¯ä»¥å¢åŠ æ²‰æµ¸æ„Ÿï¼Œæå‡ä½¿ç”¨æ¬²æœ›ã€‚</li>
<li>çœç”µã€‚æ ¹æ®è°·æ­Œçš„å®˜æ–¹æ•°æ®ï¼Œé‡‡ç”¨ OLED å±å¹•çš„æ‰‹æœºåœ¨ã€Œæ·±è‰²æ¨¡å¼ã€ä¸‹ï¼Œè€—ç”µå¯ä¸‹é™è¾¾63%ã€‚</li>
</ol>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ea2428b4d4df4a5a8a7eaca04607e892~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=3024&h=1516&s=396568&e=png&b=111111" alt="image.png"></p>
<h2>2. å¦‚ä½•é€‚é…ï¼Ÿ</h2>
<p>å¦‚æœæˆ‘ä»¬å¼€å‘é¡µé¢ï¼Œè¯¥å¦‚ä½•æ”¯æŒæ·±è‰²æ¨¡å¼å‘¢ï¼Ÿ</p>
<h3>2.1. CSS åª’ä½“æŸ¥è¯¢</h3>
<p>CSS æä¾›äº† <a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media/prefers-color-scheme">prefers-color-scheme</a> åª’ä½“æŸ¥è¯¢ç‰¹æ€§ï¼Œç”¨äºæ£€æµ‹ç”¨æˆ·æ˜¯å¦æœ‰å°†ç³»ç»Ÿçš„ä¸»é¢˜è‰²è®¾ç½®ä¸ºæµ…è‰²æˆ–è€…æ·±è‰²ã€‚</p>
<p>æ¯”å¦‚ Next.js è„šæ‰‹æ¶é»˜è®¤åˆ›å»ºé¡¹ç›®çš„ <code>app/globals.css</code>ä¸­ï¼Œå°±æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š</p>
<pre><code class="language-javascript">:root {
  --foreground-rgb: 0, 0, 0;
  --background-start-rgb: 214, 219, 220;
  --background-end-rgb: 255, 255, 255;
}

@media (prefers-color-scheme: dark) {
  :root {
    --foreground-rgb: 255, 255, 255;
    --background-start-rgb: 0, 0, 0;
    --background-end-rgb: 0, 0, 0;
  }
}
</code></pre>
<p>è¿™å°±æ˜¯ä¸€æ®µæ ¹æ®ç³»ç»Ÿçš„ä¸»é¢˜è‰²è°ƒæ•´ç½‘é¡µåŸºç¡€æ ·å¼çš„ä»£ç ã€‚æ­¤æ—¶é¡µé¢ä¼šæ ¹æ®ç³»ç»Ÿçš„å¤–è§‚æ¨¡å¼è¿›è¡Œè°ƒæ•´ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8fcc5d4d12534980a1a3ab7665b24fcb~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=923&h=630&s=471100&e=gif&f=40&b=ececee" alt="1.gif"></p>
<p>æ³¨ï¼šæµè§ˆå™¨è®¾ç½®é‡Œä¹Ÿæœ‰è®¾ç½®æ¨¡å¼çš„åœ°æ–¹ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5e3c585429d14ad591703e9b78978256~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1848&h=444&s=81383&e=png&b=26272a" alt="image.png"></p>
<p>ä½†è¿™é‡Œè®¾ç½®çš„æ˜¯æµè§ˆå™¨çš„å¤–è§‚ï¼Œä¸ä¼šå½±å“å…·ä½“é¡µé¢çš„å¤–è§‚æ¨¡å¼ã€‚</p>
<h3>2.2. JS æŸ¥è¯¢</h3>
<p>CSS æŸ¥è¯¢ä¼šè‡ªåŠ¨è·Ÿéšç³»ç»Ÿè®¾ç½®ï¼Œä½†å¦‚æœä½ è¦è‡ªå®šä¹‰å¤–è§‚æ¨¡å¼ï¼Œå°±æ¯”å¦‚å¾ˆå¤šåšå®¢é¡µé¢å³ä¸Šè§’éƒ½æœ‰ä¸ªå¤–è§‚æ¨¡å¼æŒ‰é’®ï¼Œç‚¹å‡»å¯ä»¥åˆ‡æ¢åˆ° light / dark æ¨¡å¼ï¼Œè¿™ç§å°±éœ€è¦ä¾èµ– JS äº†ã€‚</p>
<p>Web API æä¾›äº† <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/matchMedia">Window.matchMedia()</a> æ–¹æ³•ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæ–°çš„ MediaQueryList å¯¹è±¡ï¼Œè¡¨ç¤ºæŒ‡å®šçš„åª’ä½“æŸ¥è¯¢å­—ç¬¦ä¸²è§£æåçš„ç»“æœã€‚è¿”å›çš„ MediaQueryList å¯è¢«ç”¨äºåˆ¤å®š Document æ˜¯å¦åŒ¹é…åª’ä½“æŸ¥è¯¢ï¼Œæˆ–è€…ç›‘æ§ä¸€ä¸ª document æ¥åˆ¤å®šå®ƒåŒ¹é…äº†æˆ–è€…åœæ­¢åŒ¹é…äº†æ­¤åª’ä½“æŸ¥è¯¢ã€‚</p>
<h4>åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒæ·±è‰²æ¨¡å¼</h4>
<pre><code class="language-javascript">if (window.matchMedia(&#39;(prefers-color-scheme)&#39;).media !== &#39;not all&#39;) {
  console.log(&#39;ğŸ‰ Dark mode is supported&#39;);
}
</code></pre>
<p>å…¶å®æ”¯æŒç‡è¿˜è›®å¥½çš„ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/58867d0f23414c83b94d4368abb91e66~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=3430&h=1442&s=524605&e=png&b=f0e8d8" alt="image.png"></p>
<h4>ç›‘å¬æ·±è‰²æ¨¡å¼å˜åŒ–</h4>
<pre><code class="language-javascript">const darkModeMediaQuery = window.matchMedia(&#39;(prefers-color-scheme: dark)&#39;);

darkModeMediaQuery.addEventListener(&#39;change&#39;, (e) =&gt; {
  const darkModeOn = e.matches;
  console.log(`Dark mode is ${darkModeOn ? &#39;ğŸŒ’ on&#39; : &#39;â˜€ï¸ off&#39;}.`);
});
</code></pre>
<h4>è‡ªå®šä¹‰ React hook</h4>
<p>å¦‚æœä½¿ç”¨ Reactï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª hookï¼Œæ–°å»º <code>app/theme.js</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-javascript">import { useEffect, useState } from &quot;react&quot;

function useTheme() {
 
  const [theme, setTheme] = useState(&#39;light&#39;)

  useEffect(() =&gt; {

    const darkModeMediaQuery = window.matchMedia(&#39;(prefers-color-scheme: dark)&#39;);
    setTheme(darkModeMediaQuery.matches ? &#39;dark&#39; : &#39;light&#39;)
    const listener = (event) =&gt; {
      setTheme(event.matches ? &#39;dark&#39; : &#39;light&#39;);
    };

    darkModeMediaQuery.addEventListener(&#39;change&#39;, listener);
    return () =&gt; {
      darkModeMediaQuery.removeEventListener(&#39;change&#39;, listener);
    };
    
  }, [])
  
  return {
    theme,
    isDarkMode: theme === &quot;dark&quot;,
    isLightMode: theme === &quot;light&quot;,
  }
}

export default useTheme
</code></pre>
<p>ä¿®æ”¹ <code>app/page.js</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-javascript">&#39;use client&#39;

import Image from &quot;next/image&quot;;
import useTheme from &quot;./theme&quot;;

export default function Home() {
  
  const {theme} = useTheme()

  return (
    &lt;div&gt;Hello World! {theme}&lt;/div&gt;
  );
}
</code></pre>
<p>æµè§ˆå™¨æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93460b20b16b4038b4d32308b28e8e84~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1153&h=558&s=281990&e=gif&f=23&b=e4e9ec" alt="3.gif"></p>
<h3>2.3. æµ‹è¯•ä¸åŒçš„æ¨¡å¼</h3>
<p>å¦‚æœè¦æµ‹è¯•é¡µé¢çš„æµ…è‰²/æ·±è‰²æ¨¡å¼ï¼Œä¿®æ”¹ç³»ç»Ÿçš„å¤–è§‚æ¨¡å¼ä¼šæœ‰äº›éº»çƒ¦ï¼ŒChrome æä¾›äº†å¿«é€Ÿåˆ‡æ¢çš„æ–¹å¼ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f81e3cdefa1a43159a1502ffe1f3f8a9~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1196&h=558&s=366613&e=gif&f=32&b=fcfcfc" alt="2.gif"></p>
<p>å…¶æ­¥éª¤ä¸ºï¼š</p>
<ol>
<li>æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·</li>
<li>Command + Shift + P æ‰“å¼€å‘½ä»¤</li>
<li>è¾“å…¥ dark æˆ–è€… light æœç´¢å‘½ä»¤</li>
<li>å›è½¦ç¡®å®š</li>
</ol>
<p>æ³¨ï¼šè¿™åªæ˜¯ç”¨äºæµ‹è¯•ï¼Œæ•ˆæœæ˜¯æš‚æ—¶çš„ï¼Œå…³é—­å¼€å‘è€…å·¥å…·ï¼Œå°±ä¼šé€€å‡ºè®¾ç½®çš„æ ·å¼ã€‚</p>
<h2>3. å®æˆ˜åº”ç”¨</h2>
<p>åŸºç¡€çŸ¥è¯†æˆ‘ä»¬å°±è¯´è¿™ä¹ˆå¤šï¼Œåªæ˜¯å¸®åŠ©å¤§å®¶ç†è§£æ·±è‰²æ¨¡å¼çš„æ¦‚å¿µå’Œå®ç°çš„åŸºæœ¬åŸç†ã€‚</p>
<p>åœ¨ Next.js é¡¹ç›®ä¸­ï¼Œå®ç°æ‰‹åŠ¨åˆ‡æ¢å¤–è§‚æ¨¡å¼çš„æ•ˆæœï¼Œé€šå¸¸è¿˜è¦æ­é… React Context æˆ–è€…çŠ¶æ€ç®¡ç†åº“æ¥å®ç°ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ <a href="https://github.com/pacocoursey/next-themes">next-themes</a> è¿™ä¸ªåŒ…æ¥å®ç°ã€‚</p>
<h3>3.1. next-themes</h3>
<p>å®‰è£…ä¾èµ–é¡¹ï¼š</p>
<pre><code class="language-bash">npm install next-themes @headlessui/react
</code></pre>
<p>å…¶ä¸­ <a href="https://github.com/tailwindlabs/headlessui">@headlessui/react</a> æ˜¯ UI åº“ï¼Œååˆ†é€‚åˆæ­é… Tailwind.cssã€‚</p>
<p>æ–°å»º <code>app/theme-providers.js</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">&#39;use client&#39;

import { ThemeProvider } from &#39;next-themes&#39;

export function ThemeProviders({ children }) {
  return (
    &lt;ThemeProvider attribute=&quot;class&quot; defaultTheme=&quot;light&quot; enableSystem&gt;
      {children}
    &lt;/ThemeProvider&gt;
  )
}
</code></pre>
<p>ä¿®æ”¹ <code>app/layout.js</code>ï¼Œæ·»åŠ ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">import siteMetadata from &#39;@/data/siteMetadata&#39;
import &quot;./globals.css&quot;;
import { ThemeProviders } from &#39;./theme-providers&#39;

export const metadata = {
  // ...
}

export default function RootLayout({ children }) {
  return (
    &lt;html lang={siteMetadata.locale} suppressHydrationWarning&gt;
      &lt;body&gt;
        &lt;ThemeProviders&gt;
          {children}
        &lt;/ThemeProviders&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  );
}
</code></pre>
<p>ä¿®æ”¹çš„ä»£ç æœ‰ 2 ç‚¹ï¼š</p>
<ol>
<li>html ä½¿ç”¨ suppressHydrationWarning å–æ¶ˆæ°´åˆé”™è¯¯è­¦å‘Šï¼Œè¿™æ˜¯å› ä¸º next-theme ä¼šä¿®æ”¹ html å…ƒç´ çš„å±æ€§ã€‚å› ä¸º suppressHydrationWarning åªä½œç”¨äºä¸€å±‚ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒå®ƒä¼šå½±å“æ•´ä¸ªåº”ç”¨çš„æ°´åˆé”™è¯¯è­¦å‘Šã€‚</li>
<li>ä½¿ç”¨ ThemeProviders ç»„ä»¶åŒ…è£¹ children</li>
</ol>
<p>æ­¤æ—¶é¡µé¢å¹¶ä¸æœ‰ä»€ä¹ˆç‰¹æ®Šæ•ˆæœï¼Œå› ä¸ºè¿™æ­¥ç›¸å½“äºåœ¨é¡¶å±‚ä½¿ç”¨äº† React Contextï¼Œå‚¨å­˜äº†ä¸€ä¸ªç”¨äºè¡¨ç¤ºå½“å‰ä¸»é¢˜çš„å€¼ï¼Œé»˜è®¤æ˜¯ <code>&quot;light&quot;</code>ã€‚</p>
<p>æ­¤æ—¶å› ä¸ºæˆ‘ä»¬è®¾ç½®äº† <code>attribute=&quot;class&quot;</code>ï¼Œå½“åˆ‡æ¢ä¸»é¢˜çš„æ—¶å€™ï¼Œå®ƒä¼šå¯¹åº”ç”Ÿæˆ <code>class=&quot;dark&quot;</code>è¿™ç§å±æ€§ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/36e097ed44e84d79a5507beaf299116d~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1202&h=126&s=34834&e=png&b=2e2e2e" alt="image.png"></p>
<p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº† <code>style=&quot;color-scheme: dark;&quot;</code>å±æ€§ï¼Œè¯¦ç»†ä»‹ç»å‚è€ƒ <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/color-scheme">MDN color-scheme</a>ã€‚ç®€å•æ¥è¯´ï¼Œæ“ä½œç³»ç»Ÿä¼šæ ¹æ®ç”¨æˆ·é€‰æ‹©çš„é¢œè‰²æ–¹æ¡ˆå¯¹ç”¨æˆ·ç•Œé¢è¿›è¡Œè°ƒæ•´ï¼ŒåŒ…æ‹¬è¡¨å•æ§ä»¶ã€æ»šåŠ¨æ¡å’Œ CSS ç³»ç»Ÿé¢œè‰²çš„ä½¿ç”¨å€¼ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬æ”¹ç”¨äº† JS æ¥æ‰‹åŠ¨æ§åˆ¶ä¸»é¢˜å€¼ï¼Œæ‰€ä»¥å†™æ ·å¼æ•ˆæœçš„æ—¶å€™ï¼Œä¹Ÿä¸èƒ½å†ç”¨ @media (prefers-color-scheme: dark) è¿™ç§æ–¹å¼ï¼Œå®ƒä¼šæ ¹æ®ç³»ç»Ÿçš„ä¸»é¢˜å€¼è€Œé Context ä¸­çš„ä¸»é¢˜å€¼è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>å¦‚æœä½ è¦å†™ dark å’Œ light ä¸¤å¥—ä¸»é¢˜ï¼Œå› ä¸º html æ·»åŠ äº† <code>.dark</code> ç±»ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·å†™ï¼š</p>
<pre><code class="language-javascript">html,
body {
  color: #000;
  background: #fff;
}

.dark {
  html, body {
    color: #fff;
    background: #000;
  }
}
</code></pre>
<p>å½“ç„¶å› ä¸ºæˆ‘ä»¬é¡¹ç›®ä½¿ç”¨äº† Tailwind.cssï¼ŒTailwind.css ä¹Ÿæ˜¯æ”¯æŒ <a href="https://tailwindcss.com/docs/dark-mode#toggling-dark-mode-manually">Dark Mode</a> çš„ã€‚ä¿®æ”¹ <code>tailwind.config.js</code>ï¼Œæ·»åŠ ä»£ç å¦‚ä¸‹ï¼ˆå¦‚æœä½ æŒ‰ç…§ä¹‹å‰çš„æ–‡ç« å†™é¡¹ç›®ï¼Œæ­¤æ—¶åº”è¯¥å·²ç»æ·»åŠ äº†ï¼‰ï¼š</p>
<pre><code class="language-javascript">module.exports = {
  darkMode: &#39;class&#39;
}
</code></pre>
<p>ä¿®æ”¹ <code>app/page.js</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">&#39;use client&#39;

import { useState, useEffect } from &#39;react&#39;
import { useTheme } from &#39;next-themes&#39;

const ThemeSwitch = () =&gt; {
  const [mounted, setMounted] = useState(false)
  const { theme, setTheme } = useTheme()

  useEffect(() =&gt; {
    setMounted(true)
  }, [])

  if (!mounted) {
    return null
  }

  return (
    &lt;&gt;
      &lt;h1 className=&quot;text-black dark:text-white&quot;&gt;Hello World! {theme}&lt;/h1&gt;
      &lt;select value={theme} onChange={e =&gt; setTheme(e.target.value)}&gt;
        &lt;option value=&quot;system&quot;&gt;System&lt;/option&gt;
        &lt;option value=&quot;dark&quot;&gt;Dark&lt;/option&gt;
        &lt;option value=&quot;light&quot;&gt;Light&lt;/option&gt;
      &lt;/select&gt;
    &lt;/&gt;

  )
}

export default ThemeSwitch
</code></pre>
<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ useTheme å’Œ Taildwind.cssã€‚</p>
<ol>
<li>ä½¿ç”¨ useTheme éœ€è¦æ˜¯å®¢æˆ·ç«¯ç»„ä»¶ï¼Œä¸”éœ€è¦åˆ¤æ–­ç¯å¢ƒï¼Œå¦åˆ™ä¼šå¯¼è‡´æ°´åˆé”™è¯¯</li>
<li><code>&quot;text-black dark:text-white&quot;</code> å±•ç¤ºäº†å¦‚ä½•ä¸ºä¸€ä¸ªå…ƒç´ å®šä¹‰ä¸åŒä¸»é¢˜ä¸‹çš„æ ·å¼</li>
</ol>
<p>æ­¤æ—¶æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/618593f99c17417aaaf565d9d7e06ea0~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1103&h=461&s=1064578&e=gif&f=53&b=2c2c2c" alt="4.gif"></p>
<h3>3.2. é¡¹ç›®å¼€å‘</h3>
<p>æ–°å»º <code>components/ThemeSwitch.js</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">&#39;use client&#39;

import { Fragment, useEffect, useState } from &#39;react&#39;
import { useTheme } from &#39;next-themes&#39;
import { Menu, RadioGroup, Transition } from &#39;@headlessui/react&#39;

const Sun = () =&gt; (
  &lt;svg
    xmlns=&quot;http://www.w3.org/2000/svg&quot;
    viewBox=&quot;0 0 20 20&quot;
    fill=&quot;currentColor&quot;
    className=&quot;h-6 w-6 text-gray-900 dark:text-gray-100&quot;
  &gt;
    &lt;path
      fillRule=&quot;evenodd&quot;
      d=&quot;M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z&quot;
      clipRule=&quot;evenodd&quot;
    /&gt;
  &lt;/svg&gt;
)
const Moon = () =&gt; (
  &lt;svg
    xmlns=&quot;http://www.w3.org/2000/svg&quot;
    viewBox=&quot;0 0 20 20&quot;
    fill=&quot;currentColor&quot;
    className=&quot;h-6 w-6 text-gray-900 dark:text-gray-100&quot;
  &gt;
    &lt;path d=&quot;M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z&quot; /&gt;
  &lt;/svg&gt;
)
const Monitor = () =&gt; (
  &lt;svg
    xmlns=&quot;http://www.w3.org/2000/svg&quot;
    viewBox=&quot;0 0 20 20&quot;
    fill=&quot;none&quot;
    stroke=&quot;currentColor&quot;
    strokeWidth=&quot;2&quot;
    strokeLinecap=&quot;round&quot;
    strokeLinejoin=&quot;round&quot;
    className=&quot;h-6 w-6 text-gray-900 dark:text-gray-100&quot;
  &gt;
    &lt;rect x=&quot;3&quot; y=&quot;3&quot; width=&quot;14&quot; height=&quot;10&quot; rx=&quot;2&quot; ry=&quot;2&quot;&gt;&lt;/rect&gt;
    &lt;line x1=&quot;7&quot; y1=&quot;17&quot; x2=&quot;13&quot; y2=&quot;17&quot;&gt;&lt;/line&gt;
    &lt;line x1=&quot;10&quot; y1=&quot;13&quot; x2=&quot;10&quot; y2=&quot;17&quot;&gt;&lt;/line&gt;
  &lt;/svg&gt;
)

const ThemeSwitch = () =&gt; {
  const [mounted, setMounted] = useState(false)
  const { theme, setTheme, resolvedTheme } = useTheme()

  // When mounted on client, now we can show the UI
  useEffect(() =&gt; setMounted(true), [])

  if (!mounted) return null

  return (
    &lt;div className=&quot;mr-5&quot;&gt;
      &lt;Menu as=&quot;div&quot; className=&quot;relative inline-block text-left&quot;&gt;
        &lt;div&gt;
          &lt;Menu.Button&gt;{resolvedTheme === &#39;dark&#39; ? &lt;Moon /&gt; : &lt;Sun /&gt;}&lt;/Menu.Button&gt;
        &lt;/div&gt;
        &lt;Transition
          as={Fragment}
          enter=&quot;transition ease-out duration-100&quot;
          enterFrom=&quot;transform opacity-0 scale-95&quot;
          enterTo=&quot;transform opacity-100 scale-100&quot;
          leave=&quot;transition ease-in duration-75&quot;
          leaveFrom=&quot;transform opacity-100 scale-100&quot;
          leaveTo=&quot;transform opacity-0 scale-95&quot;
        &gt;
          &lt;Menu.Items className=&quot;absolute right-0 mt-2 w-32 origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none dark:bg-gray-800&quot;&gt;
            &lt;RadioGroup value={theme} onChange={setTheme}&gt;
              &lt;div className=&quot;p-1&quot;&gt;
                &lt;RadioGroup.Option value=&quot;light&quot;&gt;
                  &lt;Menu.Item&gt;
                    &lt;button className=&quot;group flex w-full items-center rounded-md px-2 py-2 text-sm&quot;&gt;
                      &lt;div className=&quot;mr-2&quot;&gt;
                        &lt;Sun /&gt;
                      &lt;/div&gt;
                      Light
                    &lt;/button&gt;
                  &lt;/Menu.Item&gt;
                &lt;/RadioGroup.Option&gt;
                &lt;RadioGroup.Option value=&quot;dark&quot;&gt;
                  &lt;Menu.Item&gt;
                    &lt;button className=&quot;group flex w-full items-center rounded-md px-2 py-2 text-sm&quot;&gt;
                      &lt;div className=&quot;mr-2&quot;&gt;
                        &lt;Moon /&gt;
                      &lt;/div&gt;
                      Dark
                    &lt;/button&gt;
                  &lt;/Menu.Item&gt;
                &lt;/RadioGroup.Option&gt;
                &lt;RadioGroup.Option value=&quot;system&quot;&gt;
                  &lt;Menu.Item&gt;
                    &lt;button className=&quot;group flex w-full items-center rounded-md px-2 py-2 text-sm&quot;&gt;
                      &lt;div className=&quot;mr-2&quot;&gt;
                        &lt;Monitor /&gt;
                      &lt;/div&gt;
                      System
                    &lt;/button&gt;
                  &lt;/Menu.Item&gt;
                &lt;/RadioGroup.Option&gt;
              &lt;/div&gt;
            &lt;/RadioGroup&gt;
          &lt;/Menu.Items&gt;
        &lt;/Transition&gt;
      &lt;/Menu&gt;
    &lt;/div&gt;
  )
}

export default ThemeSwitch
</code></pre>
<p>è¿™æ®µä»£ç çœ‹ä¼¼å¾ˆé•¿ï¼Œä½†å®ç°çš„æ•ˆæœå…¶å®å¾ˆç®€å•ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dea2cfbb8a274a338e98461edf232c9a~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1306&h=542&s=56899&e=png&b=fefefe" alt="image.png"></p>
<p>ä¸ºäº†æ–¹ä¾¿å¼•å…¥ï¼Œä¿®æ”¹ <code>jsconfig.json</code>ï¼š</p>
<pre><code class="language-javascript">{
  &quot;compilerOptions&quot;: {
    &quot;baseUrl&quot;: &quot;.&quot;,
    &quot;paths&quot;: {
      &quot;@/data/*&quot;: [&quot;data/*&quot;],
      &quot;@/components/*&quot;: [&quot;components/*&quot;],
      &quot;contentlayer/generated&quot;: [&quot;./.contentlayer/generated&quot;]
    }
  },
  // ...
}
</code></pre>
<p>æˆ‘ä»¬å°†ç»„ä»¶æ·»åŠ åˆ°æ ¹å¸ƒå±€ <code>app/layout.js</code>ä¸­ï¼š</p>
<pre><code class="language-jsx">import siteMetadata from &#39;@/data/siteMetadata&#39;
import &quot;./globals.css&quot;;
import { ThemeProviders } from &#39;./theme-providers&#39;
import ThemeSwitch from &#39;@/components/ThemeSwitch&#39;;

// ...

export default function RootLayout({ children }) {
  return (
    &lt;html lang={siteMetadata.locale} suppressHydrationWarning&gt;
      &lt;body&gt;
        &lt;ThemeProviders&gt;
          &lt;header className=&quot;flex justify-end&quot;&gt;
            &lt;ThemeSwitch /&gt;
          &lt;/header&gt;
          {children}
        &lt;/ThemeProviders&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  );
}
</code></pre>
<p>è¿™æ ·æ‰€æœ‰é¡µé¢çš„å³ä¸Šè§’éƒ½ä¼šæœ‰è¿™ä¸ªåˆ‡æ¢ä¸»é¢˜çš„æŒ‰é’®ã€‚</p>
<p>ç°åœ¨è¦åšçš„å°±æ˜¯ä¸ºå…ƒç´ è®¾ç½®ä¸åŒä¸»é¢˜çš„æ ·å¼ã€‚æ ¹æ®ä¸ŠèŠ‚çš„æè¿°æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è®¾ç½®ï¼Œä¸€ç§æ˜¯ç›´æ¥ä½¿ç”¨ CSS è¿›è¡Œè®¾ç½®ï¼š</p>
<pre><code class="language-javascript">.dark {
  // ...
}
</code></pre>
<p>ä¸€ç§æ˜¯ä½¿ç”¨ Tailwind.cssï¼Œæ·»åŠ  <code>dark:</code>å¼€å¤´çš„ç±»åï¼š</p>
<pre><code class="language-javascript">&lt;h1 className=&quot;text-3xl font-bold dark:text-white&quot;&gt;{post.title}&lt;/h1&gt;
</code></pre>
<p>æ¯”è¾ƒéº»çƒ¦çš„åœ°æ–¹åœ¨äºæ–‡ç« é¡µé¢ï¼Œå› ä¸ºæ–‡ç« çš„å†…å®¹æ¸²æŸ“æ˜¯ç”± MDX ç”Ÿæˆï¼Œä¸èƒ½ç›´æ¥æ·»åŠ ç±»åã€‚</p>
<p>ä½†å…¶å® tailwindcss-typography åŒæ ·æä¾›äº† dark mode æ”¯æŒï¼Œä½ åªè¦åœ¨å¤–å±‚æ·»åŠ ä¸€ä¸ª <code>dark:prose-invert</code> ç±»åï¼š</p>
<pre><code class="language-javascript">&lt;article class=&quot;prose dark:prose-invert&quot;&gt;{{ markdown }}&lt;/article&gt;
</code></pre>
<p>æ‰€ä»¥æˆ‘ä»¬ä¿®æ”¹ <code>app/posts/[id]/page.js</code>ï¼Œæ·»åŠ ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-jsx">// ...

const Page = ({ params }) =&gt; {
  const post = allPosts.find((post) =&gt; post._raw.flattenedPath === params.id)
  if (!post) notFound()
  const MDXContent = useMDXComponent(post.body.code)
  const jsonLd = post.structuredData
  return (
    &lt;&gt;
      &lt;script
        type=&quot;application/ld+json&quot;
        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
        /&gt;
      &lt;article className=&quot;mx-auto max-w-xl py-8 prose prose-slate dark:prose-invert&quot;&gt;
        &lt;div className=&quot;mb-8 text-center&quot;&gt;
          &lt;time dateTime={post.date} className=&quot;mb-1 text-xs text-gray-600 dark:text-white&quot;&gt;
            {dayjs(post.date).format(&#39;DD/MM/YYYY&#39;)}
          &lt;/time&gt;
          &lt;h1 className=&quot;text-3xl font-bold dark:text-white&quot;&gt;{post.title}&lt;/h1&gt;
        &lt;/div&gt;
        &lt;MDXContent /&gt;
      &lt;/article&gt;
    &lt;/&gt;
  )
}

export default Page
</code></pre>
<p>æ­¤æ—¶æ–‡ç« é¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e1a5769c7d84f10a96cf4daedba8361~tplv-k3u1fbpfcp-jj-mark:0:0:0:0:q75.image#?w=1019&h=686&s=300406&e=gif&f=55&b=fefefe" alt="5.gif"></p>
<p>æˆ‘ä»¬æˆåŠŸå®ç°äº†æ·±è‰²æ¨¡å¼ï¼</p>
<h2>é¡¹ç›®æºç </h2>
<blockquote>
<ol>
<li>åŠŸèƒ½å®ç°ï¼šåšå®¢æ”¯æŒæ·±è‰²æ¨¡å¼</li>
<li>æºç åœ°å€ï¼š<a href="https://github.com/mqyqingfeng/next-app-demo/tree/next-blog-3">https://github.com/mqyqingfeng/next-app-demo/tree/next-blog-3</a></li>
<li>ä¸‹è½½ä»£ç ï¼š<code>git clone -b next-blog-3 git@github.com:mqyqingfeng/next-app-demo.git</code></li>
</ol>
</blockquote>
<h2>å‚è€ƒé“¾æ¥</h2>
<ol>
<li><a href="https://support.apple.com/zh-cn/guide/mac-help/mchl52e1c2d2/mac">https://support.apple.com/zh-cn/guide/mac-help/mchl52e1c2d2/mac</a></li>
<li><a href="https://juejin.cn/post/7298997940019085366">https://juejin.cn/post/7298997940019085366</a></li>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media/prefers-color-scheme">https://developer.mozilla.org/zh-CN/docs/Web/CSS/@media/prefers-color-scheme</a></li>
<li><a href="https://web.dev/articles/prefers-color-scheme?hl=zh-cn#reacting_on_dark_mode_changes">https://web.dev/articles/prefers-color-scheme?hl=zh-cn#reacting_on_dark_mode_changes</a></li>
<li><a href="https://web.dev/articles/color-scheme?hl=zh-cn">https://web.dev/articles/color-scheme?hl=zh-cn</a></li>
<li><a href="https://www.uisdc.com/dark-mode-history">https://www.uisdc.com/dark-mode-history</a></li>
<li><a href="https://juejin.cn/post/7062986403205873701">https://juejin.cn/post/7062986403205873701</a></li>
</ol>

</body>
</html>
  